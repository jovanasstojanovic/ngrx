export class SdpUtils {
    static iceCandidateType(candidateStr) {
        return candidateStr.split(' ')[7];
    }
    static maybeSetOpusOptions(sdp, params) {
        // Set Opus in Stereo, if stereo is true, unset it, if stereo is false, and
        // do nothing if otherwise.
        if (params.opusStereo) {
            sdp = SdpUtils.setCodecParam(sdp, 'opus/48000', 'stereo', '1');
        }
        else if (!params.opusStereo) {
            sdp = SdpUtils.removeCodecParam(sdp, 'opus/48000', 'stereo');
        }
        // Set Opus FEC, if opusfec is true, unset it, if opusfec is false, and
        // do nothing if otherwise.
        if (params.opusFec) {
            sdp = SdpUtils.setCodecParam(sdp, 'opus/48000', 'useinbandfec', '1');
        }
        else if (!params.opusFec) {
            sdp = SdpUtils.removeCodecParam(sdp, 'opus/48000', 'useinbandfec');
        }
        // Set Opus DTX, if opusdtx is true, unset it, if opusdtx is false, and
        // do nothing if otherwise.
        if (params.opusDtx) {
            sdp = SdpUtils.setCodecParam(sdp, 'opus/48000', 'usedtx', '1');
        }
        else if (!params.opusDtx) {
            sdp = SdpUtils.removeCodecParam(sdp, 'opus/48000', 'usedtx');
        }
        // Set Opus maxplaybackrate, if requested.
        if (params.opusMaxPbr) {
            sdp = SdpUtils.setCodecParam(sdp, 'opus/48000', 'maxplaybackrate', params.opusMaxPbr);
        }
        return sdp;
    }
    static maybeSetAudioSendBitRate(sdp, params) {
        if (!params.audioSendBitrate) {
            return sdp;
        }
        // console.log('Prefer audio send bitrate: ' + params.audioSendBitrate);
        return SdpUtils.preferBitRate(sdp, params.audioSendBitrate, 'audio');
    }
    static maybeSetAudioReceiveBitRate(sdp, params) {
        if (!params.audioRecvBitrate) {
            return sdp;
        }
        // console.log('Prefer audio receive bitrate: ' + params.audioRecvBitrate);
        return SdpUtils.preferBitRate(sdp, params.audioRecvBitrate, 'audio');
    }
    static maybeSetVideoSendBitRate(sdp, params) {
        if (!params.videoSendBitrate) {
            return sdp;
        }
        // console.log('Prefer video send bitrate: ' + params.videoSendBitrate);
        return SdpUtils.preferBitRate(sdp, params.videoSendBitrate, 'video');
    }
    static maybeSetVideoReceiveBitRate(sdp, params) {
        if (!params.videoRecvBitrate) {
            return sdp;
        }
        // console.log('Prefer video receive bitrate: ' + params.videoRecvBitrate);
        return SdpUtils.preferBitRate(sdp, params.videoRecvBitrate, 'video');
    }
    // Add a b=AS:bitrate line to the m=mediaType section.
    static preferBitRate(sdp, bitrate, mediaType) {
        const sdpLines = sdp.split('\r\n');
        // Find m line for the given mediaType.
        const mLineIndex = SdpUtils.findLine(sdpLines, 'm=', mediaType);
        if (mLineIndex === null) {
            // console.log('Failed to add bandwidth line to sdp, as no m-line found');
            return sdp;
        }
        // Find next m-line if any.
        let nextMLineIndex = SdpUtils.findLineInRange(sdpLines, mLineIndex + 1, -1, 'm=');
        if (nextMLineIndex === null) {
            nextMLineIndex = sdpLines.length;
        }
        // Find c-line corresponding to the m-line.
        const cLineIndex = SdpUtils.findLineInRange(sdpLines, mLineIndex + 1, nextMLineIndex, 'c=');
        if (cLineIndex === null) {
            // console.log('Failed to add bandwidth line to sdp, as no c-line found');
            return sdp;
        }
        // Check if bandwidth line already exists between c-line and next m-line.
        const bLineIndex = SdpUtils.findLineInRange(sdpLines, cLineIndex + 1, nextMLineIndex, 'b=AS');
        if (bLineIndex) {
            sdpLines.splice(bLineIndex, 1);
        }
        // Create the b (bandwidth) sdp line.
        const bwLine = 'b=AS:' + bitrate;
        // As per RFC 4566, the b line should follow after c-line.
        sdpLines.splice(cLineIndex + 1, 0, bwLine);
        sdp = sdpLines.join('\r\n');
        return sdp;
    }
    // Add an a=fmtp: x-google-min-bitrate=kbps line, if videoSendInitialBitrate
    // is specified. We'll also add a x-google-min-bitrate value, since the max
    // must be >= the min.
    static maybeSetVideoSendInitialBitRate(sdp, params) {
        if (!params.videoSendInitialBitrate) {
            return sdp;
        }
        let initialBitrate = typeof params.videoSendInitialBitrate === 'string' ?
            parseInt(params.videoSendInitialBitrate, 10) : params.videoSendInitialBitrate;
        if (!initialBitrate) {
            return sdp;
        }
        // Validate the initial bitrate value.
        let maxBitrate = (typeof initialBitrate === 'string') ? parseInt(initialBitrate, 10) : initialBitrate;
        if (params.videoSendBitrate) {
            const bitrate = typeof params.videoSendBitrate === 'string' ?
                parseInt(params.videoSendBitrate, 10) : params.videoSendBitrate;
            if (bitrate) {
                if (initialBitrate > bitrate) {
                    // console.log('Clamping initial bitrate to max bitrate of ' + bitrate + ' kbps.');
                    initialBitrate = bitrate;
                    params.videoSendInitialBitrate = initialBitrate;
                }
                maxBitrate = bitrate;
            }
        }
        const sdpLines = sdp.split('\r\n');
        // Search for m line.
        const mLineIndex = SdpUtils.findLine(sdpLines, 'm=', 'video');
        if (mLineIndex === null) {
            // console.log('Failed to find video m-line');
            return sdp;
        }
        // Figure out the first codec payload type on the m=video SDP line.
        const videoMLine = sdpLines[mLineIndex];
        const pattern = new RegExp('m=video\\s\\d+\\s[A-Z/]+\\s');
        const sendPayloadType = videoMLine.split(pattern)[1].split(' ')[0];
        const line = SdpUtils.findLine(sdpLines, 'a=rtpmap', sendPayloadType);
        if (!line) {
            return sdp;
        }
        const fmtpLine = sdpLines[line];
        const codecName = fmtpLine.split('a=rtpmap:' +
            sendPayloadType)[1].split('/')[0];
        // Use codec from params if specified via URL param, otherwise use from SDP.
        const codec = params.videoSendCodec || codecName;
        sdp = SdpUtils.setCodecParam(sdp, codec, 'x-google-min-bitrate', params.videoSendInitialBitrate.toString());
        sdp = SdpUtils.setCodecParam(sdp, codec, 'x-google-max-bitrate', maxBitrate.toString());
        return sdp;
    }
    static removePayloadTypeFromMline(mLine, payloadType) {
        const mLineArray = mLine.split(' ');
        for (let i = 0; i < mLineArray.length; ++i) {
            if (mLineArray[i] === payloadType.toString()) {
                mLineArray.splice(i, 1);
            }
        }
        return mLineArray.join(' ');
    }
    static removeCodecByName(sdpLines, codec) {
        const index = SdpUtils.findLine(sdpLines, 'a=rtpmap', codec);
        if (index === null) {
            return sdpLines;
        }
        const payloadType = SdpUtils.getCodecPayloadTypeFromLine(sdpLines[index]);
        if (!payloadType) {
            return sdpLines;
        }
        sdpLines.splice(index, 1);
        // Search for the video m= line and remove the codec.
        const mLineIndex = SdpUtils.findLine(sdpLines, 'm=', 'video');
        if (mLineIndex === null) {
            return sdpLines;
        }
        sdpLines[mLineIndex] = SdpUtils.removePayloadTypeFromMline(sdpLines[mLineIndex], payloadType);
        return sdpLines;
    }
    static removeCodecByPayloadType(sdpLines, payloadType) {
        const index = SdpUtils.findLine(sdpLines, 'a=rtpmap', payloadType.toString());
        if (index === null) {
            return sdpLines;
        }
        sdpLines.splice(index, 1);
        // Search for the video m= line and remove the codec.
        const mLineIndex = SdpUtils.findLine(sdpLines, 'm=', 'video');
        if (mLineIndex === null) {
            return sdpLines;
        }
        sdpLines[mLineIndex] = SdpUtils.removePayloadTypeFromMline(sdpLines[mLineIndex], payloadType);
        return sdpLines;
    }
    static maybeRemoveVideoFec(sdp, params) {
        if (params.videoFec !== false) {
            return sdp;
        }
        let sdpLines = sdp.split('\r\n');
        let index = SdpUtils.findLine(sdpLines, 'a=rtpmap', 'red');
        if (index === null) {
            return sdp;
        }
        const redPayloadType = SdpUtils.getCodecPayloadTypeFromLine(sdpLines[index]);
        if (redPayloadType === null) {
            return sdp;
        }
        sdpLines = SdpUtils.removeCodecByPayloadType(sdpLines, redPayloadType);
        sdpLines = SdpUtils.removeCodecByName(sdpLines, 'ulpfec');
        // Remove fmtp lines associated with red codec.
        index = SdpUtils.findLine(sdpLines, 'a=fmtp', redPayloadType.toString());
        if (index === null) {
            return sdp;
        }
        const fmtpLine = SdpUtils.parseFmtpLine(sdpLines[index]);
        const rtxPayloadType = fmtpLine?.pt;
        if (!rtxPayloadType || rtxPayloadType === null) {
            return sdp;
        }
        sdpLines.splice(index, 1);
        sdpLines = SdpUtils.removeCodecByPayloadType(sdpLines, rtxPayloadType);
        return sdpLines.join('\r\n');
    }
    // Promotes |audioSendCodec| to be the first in the m=audio line, if set.
    static maybePreferAudioSendCodec(sdp, params) {
        return SdpUtils.maybePreferCodec(sdp, 'audio', 'send', params.audioSendCodec);
    }
    // Promotes |audioRecvCodec| to be the first in the m=audio line, if set.
    static maybePreferAudioReceiveCodec(sdp, params) {
        return SdpUtils.maybePreferCodec(sdp, 'audio', 'receive', params.audioRecvCodec);
    }
    // Promotes |videoSendCodec| to be the first in the m=audio line, if set.
    static maybePreferVideoSendCodec(sdp, params) {
        return SdpUtils.maybePreferCodec(sdp, 'video', 'send', params.videoSendCodec);
    }
    // Promotes |videoRecvCodec| to be the first in the m=audio line, if set.
    static maybePreferVideoReceiveCodec(sdp, params) {
        return SdpUtils.maybePreferCodec(sdp, 'video', 'receive', params.videoRecvCodec);
    }
    // Sets |codec| as the default |type| codec if it's present.
    // The format of |codec| is 'NAME/RATE', e.g. 'opus/48000'.
    static maybePreferCodec(sdp, type, dir, codec) {
        // let str = type + ' ' + dir + ' codec';
        if (!codec) {
            // console.log('No preference on ' + str + '.');
            return sdp;
        }
        // console.log('Prefer ' + str + ': ' + codec);
        const sdpLines = sdp.split('\r\n');
        // Search for m line.
        const mLineIndex = SdpUtils.findLine(sdpLines, 'm=', type);
        if (mLineIndex === null) {
            return sdp;
        }
        // If the codec is available, set it as the default in m line.
        let payload = null;
        // Iterate through rtpmap enumerations to find all matching codec entries
        for (let i = sdpLines.length - 1; i >= 0; --i) {
            // Finds first match in rtpmap
            const index = SdpUtils.findLineInRange(sdpLines, i, 0, 'a=rtpmap', codec, 'desc');
            if (index !== null) {
                // Skip all of the entries between i and index match
                i = index;
                payload = SdpUtils.getCodecPayloadTypeFromLine(sdpLines[index]);
                if (payload) {
                    // Move codec to top
                    sdpLines[mLineIndex] = SdpUtils.setDefaultCodec(sdpLines[mLineIndex], payload);
                }
            }
            else {
                // No match means we can break the loop
                break;
            }
        }
        sdp = sdpLines.join('\r\n');
        return sdp;
    }
    // Set fmtp param to specific codec in SDP. If param does not exists, add it.
    static setCodecParam(sdp, codec, param, value) {
        const sdpLines = sdp.split('\r\n');
        const fmtpLineIndex = SdpUtils.findFmtpLine(sdpLines, codec);
        let fmtpObj = { pt: '', params: {} };
        if (fmtpLineIndex === null) {
            const index = SdpUtils.findLine(sdpLines, 'a=rtpmap', codec);
            if (index === null) {
                return sdp;
            }
            const payload = SdpUtils.getCodecPayloadTypeFromLine(sdpLines[index]);
            if (payload === null) {
                return sdp;
            }
            fmtpObj.pt = payload.toString();
            fmtpObj.params = {};
            fmtpObj.params[param] = value;
            const result = SdpUtils.writeFmtpLine(fmtpObj);
            if (result) {
                sdpLines.splice(index + 1, 0, result);
            }
        }
        else {
            fmtpObj = SdpUtils.parseFmtpLine(sdpLines[fmtpLineIndex]);
            if (fmtpObj) {
                fmtpObj.params[param] = value;
                const result = SdpUtils.writeFmtpLine(fmtpObj);
                if (result) {
                    sdpLines[fmtpLineIndex] = result;
                }
            }
        }
        sdp = sdpLines.join('\r\n');
        return sdp;
    }
    // Remove fmtp param if it exists.
    static removeCodecParam(sdp, codec, param) {
        const sdpLines = sdp.split('\r\n');
        const fmtpLineIndex = SdpUtils.findFmtpLine(sdpLines, codec);
        if (fmtpLineIndex === null) {
            return sdp;
        }
        const map = SdpUtils.parseFmtpLine(sdpLines[fmtpLineIndex]);
        if (map === null) {
            return sdp;
        }
        delete map.params[param];
        const newLine = SdpUtils.writeFmtpLine(map);
        if (newLine === null) {
            sdpLines.splice(fmtpLineIndex, 1);
        }
        else {
            sdpLines[fmtpLineIndex] = newLine;
        }
        sdp = sdpLines.join('\r\n');
        return sdp;
    }
    // Split an fmtp line into an object including 'pt' and 'params'.
    static parseFmtpLine(fmtpLine) {
        const fmtpObj = { pt: '', params: {} };
        const spacePos = fmtpLine.indexOf(' ');
        const keyValues = fmtpLine.substring(spacePos + 1).split(';');
        const pattern = new RegExp('a=fmtp:(\\d+)');
        const result = fmtpLine.match(pattern);
        if (result && result.length === 2) {
            fmtpObj.pt = result[1];
        }
        else {
            return null;
        }
        const params = {};
        for (const pairString of keyValues) {
            const pair = pairString.split('=');
            if (pair.length === 2) {
                params[pair[0]] = pair[1];
            }
        }
        fmtpObj.params = params;
        return fmtpObj;
    }
    // Generate an fmtp line from an object including 'pt' and 'params'.
    static writeFmtpLine(fmtpObj) {
        if (!Object.prototype.hasOwnProperty.call(fmtpObj, 'pt') || !Object.prototype.hasOwnProperty.call(fmtpObj, 'params')) {
            return null;
        }
        const pt = fmtpObj.pt;
        const params = fmtpObj.params;
        const keyValues = [];
        let i = 0;
        for (const key in params) {
            if (params[key]) {
                keyValues[i] = key + '=' + params[key];
                ++i;
            }
        }
        if (i === 0) {
            return null;
        }
        return 'a=fmtp:' + pt?.toString() + ' ' + keyValues.join(';');
    }
    // Find fmtp attribute for |codec| in |sdpLines|.
    static findFmtpLine(sdpLines, codec) {
        // Find payload of codec.
        const payload = SdpUtils.getCodecPayloadType(sdpLines, codec);
        // Find the payload in fmtp line.
        return payload ? SdpUtils.findLine(sdpLines, 'a=fmtp:' + payload.toString()) : null;
    }
    // Find the line in sdpLines that starts with |prefix|, and, if specified,
    // contains |substr| (case-insensitive search).
    static findLine(sdpLines, prefix, substr) {
        return SdpUtils.findLineInRange(sdpLines, 0, -1, prefix, substr);
    }
    // Find the line in sdpLines[startLine...endLine - 1] that starts with |prefix|
    // and, if specified, contains |substr| (case-insensitive search).
    static findLineInRange(sdpLines, startLine, endLine, prefix, substr, direction) {
        if (direction === undefined) {
            direction = 'asc';
        }
        direction = direction || 'asc';
        if (direction === 'asc') {
            // Search beginning to end
            const realEndLine = endLine !== -1 ? endLine : sdpLines.length;
            for (let i = startLine; i < realEndLine; ++i) {
                if (prefix && sdpLines[i].indexOf(prefix) === 0) {
                    if (!substr ||
                        sdpLines[i].toLowerCase().indexOf(substr.toLowerCase()) !== -1) {
                        return i;
                    }
                }
            }
        }
        else {
            // Search end to beginning
            const realStartLine = startLine !== -1 ? startLine : sdpLines.length - 1;
            for (let j = realStartLine; j >= 0; --j) {
                if (prefix && sdpLines[j].indexOf(prefix) === 0) {
                    if (!substr ||
                        sdpLines[j].toLowerCase().indexOf(substr.toLowerCase()) !== -1) {
                        return j;
                    }
                }
            }
        }
        return null;
    }
    // Gets the codec payload type from sdp lines.
    static getCodecPayloadType(sdpLines, codec) {
        const index = SdpUtils.findLine(sdpLines, 'a=rtpmap', codec);
        return index ? SdpUtils.getCodecPayloadTypeFromLine(sdpLines[index]) : null;
    }
    // Gets the codec payload type from an a=rtpmap:X line.
    static getCodecPayloadTypeFromLine(sdpLine) {
        const pattern = new RegExp('a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+');
        const result = sdpLine.match(pattern);
        return (result && result.length === 2) ? result[1] : null;
    }
    // Returns a new m= line with the specified codec as the first one.
    static setDefaultCodec(mLine, payload) {
        const elements = mLine.split(' ');
        // Just copy the first three parameters; codec order starts on fourth.
        const newLine = elements.slice(0, 3);
        // Put target payload first and copy in the rest.
        newLine.push(payload);
        for (let i = 3; i < elements.length; i++) {
            if (elements[i] !== payload) {
                newLine.push(elements[i]);
            }
        }
        return newLine.join(' ');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2RwLXV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3gtd2VicnRjL3NyYy9saWIvc2RwLXV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVdBLE1BQU0sT0FBUSxRQUFRO0lBRWIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFlBQW9CO1FBQ2pELE9BQU8sWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRU0sTUFBTSxDQUFDLG1CQUFtQixDQUFDLEdBQVcsRUFBRSxNQUFtQjtRQUNoRSwyRUFBMkU7UUFDM0UsMkJBQTJCO1FBQzNCLElBQUksTUFBTSxDQUFDLFVBQVUsRUFBRTtZQUNyQixHQUFHLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztTQUNoRTthQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFO1lBQzdCLEdBQUcsR0FBRyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztTQUM5RDtRQUVELHVFQUF1RTtRQUN2RSwyQkFBMkI7UUFDM0IsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFO1lBQ2xCLEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ3RFO2FBQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7WUFDMUIsR0FBRyxHQUFHLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsWUFBWSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1NBQ3BFO1FBRUQsdUVBQXVFO1FBQ3ZFLDJCQUEyQjtRQUMzQixJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUU7WUFDbEIsR0FBRyxHQUFHLFFBQVEs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ZW50IjpbImltcG9ydCB7IFNkcFNldHRpbmdzIH0gZnJvbSBcIi4vaW50ZXJmYWNlcy9zZHAtc2V0dGluZ3NcIjtcblxuZXhwb3J0IGludGVyZmFjZSBGb3JtYXRPYmplY3Qge1xuICBwdDogc3RyaW5nO1xuICBwYXJhbXM6IEZvcm1hdFBhcmFtc1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZvcm1hdFBhcmFtcyB7XG4gIFtrZXk6IHN0cmluZ106IHN0cmluZyB8IG51bWJlclxufVxuXG5leHBvcnQgY2xhc3MgIFNkcFV0aWxzIHtcblxuICBwdWJsaWMgc3RhdGljIGljZUNhbmRpZGF0ZVR5cGUoY2FuZGlkYXRlU3RyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBjYW5kaWRhdGVTdHIuc3BsaXQoJyAnKVs3XTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbWF5YmVTZXRPcHVzT3B0aW9ucyhzZHA6IHN0cmluZywgcGFyYW1zOiBTZHBTZXR0aW5ncyk6IHN0cmluZyB7XG4gICAgLy8gU2V0IE9wdXMgaW4gU3RlcmVvLCBpZiBzdGVyZW8gaXMgdHJ1ZSwgdW5zZXQgaXQsIGlmIHN0ZXJlbyBpcyBmYWxzZSwgYW5kXG4gICAgLy8gZG8gbm90aGluZyBpZiBvdGhlcndpc2UuXG4gICAgaWYgKHBhcmFtcy5vcHVzU3RlcmVvKSB7XG4gICAgICBzZHAgPSBTZHBVdGlscy5zZXRDb2RlY1BhcmFtKHNkcCwgJ29wdXMvNDgwMDAnLCAnc3RlcmVvJywgJzEnKTtcbiAgICB9IGVsc2UgaWYgKCFwYXJhbXMub3B1c1N0ZXJlbykge1xuICAgICAgc2RwID0gU2RwVXRpbHMucmVtb3ZlQ29kZWNQYXJhbShzZHAsICdvcHVzLzQ4MDAwJywgJ3N0ZXJlbycpO1xuICAgIH1cblxuICAgIC8vIFNldCBPcHVzIEZFQywgaWYgb3B1c2ZlYyBpcyB0cnVlLCB1bnNldCBpdCwgaWYgb3B1c2ZlYyBpcyBmYWxzZSwgYW5kXG4gICAgLy8gZG8gbm90aGluZyBpZiBvdGhlcndpc2UuXG4gICAgaWYgKHBhcmFtcy5vcHVzRmVjKSB7XG4gICAgICBzZHAgPSBTZHBVdGlscy5zZXRDb2RlY1BhcmFtKHNkcCwgJ29wdXMvNDgwMDAnLCAndXNlaW5iYW5kZmVjJywgJzEnKTtcbiAgICB9IGVsc2UgaWYgKCFwYXJhbXMub3B1c0ZlYykge1xuICAgICAgc2RwID0gU2RwVXRpbHMucmVtb3ZlQ29kZWNQYXJhbShzZHAsICdvcHVzLzQ4MDAwJywgJ3VzZWluYmFuZGZlYycpO1xuICAgIH1cblxuICAgIC8vIFNldCBPcHVzIERUWCwgaWYgb3B1c2R0eCBpcyB0cnVlLCB1bnNldCBpdCwgaWYgb3B1c2R0eCBpcyBmYWxzZSwgYW5kXG4gICAgLy8gZG8gbm90aGluZyBpZiBvdGhlcndpc2UuXG4gICAgaWYgKHBhcmFtcy5vcHVzRHR4KSB7XG4gICAgICBzZHAgPSBTZHBVdGlscy5zZXRDb2RlY1BhcmFtKHNkcCwgJ29wdXMvNDgwMDAnLCAndXNlZHR4JywgJzEnKTtcbiAgICB9IGVsc2UgaWYgKCFwYXJhbXMub3B1c0R0eCkge1xuICAgICAgc2RwID0gU2RwVXRpbHMucmVtb3ZlQ29kZWNQYXJhbShzZHAsICdvcHVzLzQ4MDAwJywgJ3VzZWR0eCcpO1xuICAgIH1cblxuICAgIC8vIFNldCBPcHVzIG1heHBsYXliYWNrcmF0ZSwgaWYgcmVxdWVzdGVkLlxuICAgIGlmIChwYXJhbXMub3B1c01heFBicikge1xuICAgICAgc2RwID0gU2RwVXRpbHMuc2V0Q29kZWNQYXJhbShcbiAgICAgICAgICBzZHAsICdvcHVzLzQ4MDAwJywgJ21heHBsYXliYWNrcmF0ZScsIHBhcmFtcy5vcHVzTWF4UGJyKTtcbiAgICB9XG4gICAgcmV0dXJuIHNkcDtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbWF5YmVTZXRBdWRpb1NlbmRCaXRSYXRlKHNkcDogc3RyaW5nLCBwYXJhbXM6IFNkcFNldHRpbmdzKTogc3RyaW5nIHtcbiAgICBpZiAoIXBhcmFtcy5hdWRpb1NlbmRCaXRyYXRlKSB7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZygnUHJlZmVyIGF1ZGlvIHNlbmQgYml0cmF0ZTogJyArIHBhcmFtcy5hdWRpb1NlbmRCaXRyYXRlKTtcbiAgICByZXR1cm4gU2RwVXRpbHMucHJlZmVyQml0UmF0ZShzZHAsIHBhcmFtcy5hdWRpb1NlbmRCaXRyYXRlLCAnYXVkaW8nKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbWF5YmVTZXRBdWRpb1JlY2VpdmVCaXRSYXRlKHNkcDogc3RyaW5nLCBwYXJhbXM6IFNkcFNldHRpbmdzKTogc3RyaW5nIHtcbiAgICBpZiAoIXBhcmFtcy5hdWRpb1JlY3ZCaXRyYXRlKSB7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZygnUHJlZmVyIGF1ZGlvIHJlY2VpdmUgYml0cmF0ZTogJyArIHBhcmFtcy5hdWRpb1JlY3ZCaXRyYXRlKTtcbiAgICByZXR1cm4gU2RwVXRpbHMucHJlZmVyQml0UmF0ZShzZHAsIHBhcmFtcy5hdWRpb1JlY3ZCaXRyYXRlLCAnYXVkaW8nKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbWF5YmVTZXRWaWRlb1NlbmRCaXRSYXRlKHNkcDogc3RyaW5nLCBwYXJhbXM6IFNkcFNldHRpbmdzKTogc3RyaW5nIHtcbiAgICBpZiAoIXBhcmFtcy52aWRlb1NlbmRCaXRyYXRlKSB7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZygnUHJlZmVyIHZpZGVvIHNlbmQgYml0cmF0ZTogJyArIHBhcmFtcy52aWRlb1NlbmRCaXRyYXRlKTtcbiAgICByZXR1cm4gU2RwVXRpbHMucHJlZmVyQml0UmF0ZShzZHAsIHBhcmFtcy52aWRlb1NlbmRCaXRyYXRlLCAndmlkZW8nKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbWF5YmVTZXRWaWRlb1JlY2VpdmVCaXRSYXRlKHNkcDogc3RyaW5nLCBwYXJhbXM6IFNkcFNldHRpbmdzKTogc3RyaW5nIHtcbiAgICBpZiAoIXBhcmFtcy52aWRlb1JlY3ZCaXRyYXRlKSB7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZygnUHJlZmVyIHZpZGVvIHJlY2VpdmUgYml0cmF0ZTogJyArIHBhcmFtcy52aWRlb1JlY3ZCaXRyYXRlKTtcbiAgICByZXR1cm4gU2RwVXRpbHMucHJlZmVyQml0UmF0ZShzZHAsIHBhcmFtcy52aWRlb1JlY3ZCaXRyYXRlLCAndmlkZW8nKTtcbiAgfVxuXG4gIC8vIEFkZCBhIGI9QVM6Yml0cmF0ZSBsaW5lIHRvIHRoZSBtPW1lZGlhVHlwZSBzZWN0aW9uLlxuICBwdWJsaWMgc3RhdGljIHByZWZlckJpdFJhdGUoc2RwOiBzdHJpbmcsIGJpdHJhdGU6IHN0cmluZyB8IG51bWJlciwgbWVkaWFUeXBlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNkcExpbmVzID0gc2RwLnNwbGl0KCdcXHJcXG4nKTtcblxuICAgIC8vIEZpbmQgbSBsaW5lIGZvciB0aGUgZ2l2ZW4gbWVkaWFUeXBlLlxuICAgIGNvbnN0IG1MaW5lSW5kZXggPSBTZHBVdGlscy5maW5kTGluZShzZHBMaW5lcywgJ209JywgbWVkaWFUeXBlKTtcbiAgICBpZiAobUxpbmVJbmRleCA9PT0gbnVsbCkge1xuICAgICAgLy8gY29uc29sZS5sb2coJ0ZhaWxlZCB0byBhZGQgYmFuZHdpZHRoIGxpbmUgdG8gc2RwLCBhcyBubyBtLWxpbmUgZm91bmQnKTtcbiAgICAgIHJldHVybiBzZHA7XG4gICAgfVxuXG4gICAgLy8gRmluZCBuZXh0IG0tbGluZSBpZiBhbnkuXG4gICAgbGV0IG5leHRNTGluZUluZGV4ID0gU2RwVXRpbHMuZmluZExpbmVJblJhbmdlKHNkcExpbmVzLCBtTGluZUluZGV4ICsgMSwgLTEsICdtPScpO1xuICAgIGlmIChuZXh0TUxpbmVJbmRleCA9PT0gbnVsbCkge1xuICAgICAgbmV4dE1MaW5lSW5kZXggPSBzZHBMaW5lcy5sZW5ndGg7XG4gICAgfVxuXG4gICAgLy8gRmluZCBjLWxpbmUgY29ycmVzcG9uZGluZyB0byB0aGUgbS1saW5lLlxuICAgIGNvbnN0IGNMaW5lSW5kZXggPSBTZHBVdGlscy5maW5kTGluZUluUmFuZ2Uoc2RwTGluZXMsIG1MaW5lSW5kZXggKyAxLFxuICAgICAgICBuZXh0TUxpbmVJbmRleCwgJ2M9Jyk7XG4gICAgaWYgKGNMaW5lSW5kZXggPT09IG51bGwpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdGYWlsZWQgdG8gYWRkIGJhbmR3aWR0aCBsaW5lIHRvIHNkcCwgYXMgbm8gYy1saW5lIGZvdW5kJyk7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIGJhbmR3aWR0aCBsaW5lIGFscmVhZHkgZXhpc3RzIGJldHdlZW4gYy1saW5lIGFuZCBuZXh0IG0tbGluZS5cbiAgICBjb25zdCBiTGluZUluZGV4ID0gU2RwVXRpbHMuZmluZExpbmVJblJhbmdlKHNkcExpbmVzLCBjTGluZUluZGV4ICsgMSxcbiAgICAgICAgbmV4dE1MaW5lSW5kZXgsICdiPUFTJyk7XG4gICAgaWYgKGJMaW5lSW5kZXgpIHtcbiAgICAgIHNkcExpbmVzLnNwbGljZShiTGluZUluZGV4LCAxKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgdGhlIGIgKGJhbmR3aWR0aCkgc2RwIGxpbmUuXG4gICAgY29uc3QgYndMaW5lID0gJ2I9QVM6JyArIGJpdHJhdGU7XG4gICAgLy8gQXMgcGVyIFJGQyA0NTY2LCB0aGUgYiBsaW5lIHNob3VsZCBmb2xsb3cgYWZ0ZXIgYy1saW5lLlxuICAgIHNkcExpbmVzLnNwbGljZShjTGluZUluZGV4ICsgMSwgMCwgYndMaW5lKTtcbiAgICBzZHAgPSBzZHBMaW5lcy5qb2luKCdcXHJcXG4nKTtcbiAgICByZXR1cm4gc2RwO1xuICB9XG5cbiAgLy8gQWRkIGFuIGE9Zm10cDogeC1nb29nbGUtbWluLWJpdHJhdGU9a2JwcyBsaW5lLCBpZiB2aWRlb1NlbmRJbml0aWFsQml0cmF0ZVxuICAvLyBpcyBzcGVjaWZpZWQuIFdlJ2xsIGFsc28gYWRkIGEgeC1nb29nbGUtbWluLWJpdHJhdGUgdmFsdWUsIHNpbmNlIHRoZSBtYXhcbiAgLy8gbXVzdCBiZSA+PSB0aGUgbWluLlxuICBwdWJsaWMgc3RhdGljIG1heWJlU2V0VmlkZW9TZW5kSW5pdGlhbEJpdFJhdGUoc2RwOiBzdHJpbmcsIHBhcmFtczogU2RwU2V0dGluZ3MpOiBzdHJpbmcge1xuICAgIGlmICghcGFyYW1zLnZpZGVvU2VuZEluaXRpYWxCaXRyYXRlKSB7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cbiAgICBsZXQgaW5pdGlhbEJpdHJhdGUgPSB0eXBlb2YgcGFyYW1zLnZpZGVvU2VuZEluaXRpYWxCaXRyYXRlID09PSAnc3RyaW5nJyA/XG4gICAgICBwYXJzZUludChwYXJhbXMudmlkZW9TZW5kSW5pdGlhbEJpdHJhdGUsIDEwKSA6IHBhcmFtcy52aWRlb1NlbmRJbml0aWFsQml0cmF0ZTtcbiAgICBpZiAoIWluaXRpYWxCaXRyYXRlKSB7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHRoZSBpbml0aWFsIGJpdHJhdGUgdmFsdWUuXG4gICAgbGV0IG1heEJpdHJhdGUgPSAodHlwZW9mIGluaXRpYWxCaXRyYXRlID09PSAnc3RyaW5nJykgPyBwYXJzZUludChpbml0aWFsQml0cmF0ZSwgMTApIDogaW5pdGlhbEJpdHJhdGU7XG4gICAgaWYgKHBhcmFtcy52aWRlb1NlbmRCaXRyYXRlKSB7XG4gICAgICBjb25zdCBiaXRyYXRlID0gdHlwZW9mIHBhcmFtcy52aWRlb1NlbmRCaXRyYXRlID09PSAnc3RyaW5nJyA/XG4gICAgICAgIHBhcnNlSW50KHBhcmFtcy52aWRlb1NlbmRCaXRyYXRlLCAxMCkgOiBwYXJhbXMudmlkZW9TZW5kQml0cmF0ZTtcbiAgICAgIGlmIChiaXRyYXRlKSB7XG4gICAgICAgIGlmIChpbml0aWFsQml0cmF0ZSA+IGJpdHJhdGUpIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnQ2xhbXBpbmcgaW5pdGlhbCBiaXRyYXRlIHRvIG1heCBiaXRyYXRlIG9mICcgKyBiaXRyYXRlICsgJyBrYnBzLicpO1xuICAgICAgICAgIGluaXRpYWxCaXRyYXRlID0gYml0cmF0ZTtcbiAgICAgICAgICBwYXJhbXMudmlkZW9TZW5kSW5pdGlhbEJpdHJhdGUgPSBpbml0aWFsQml0cmF0ZTtcbiAgICAgICAgfVxuICAgICAgICBtYXhCaXRyYXRlID0gYml0cmF0ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBzZHBMaW5lcyA9IHNkcC5zcGxpdCgnXFxyXFxuJyk7XG5cbiAgICAvLyBTZWFyY2ggZm9yIG0gbGluZS5cbiAgICBjb25zdCBtTGluZUluZGV4ID0gU2RwVXRpbHMuZmluZExpbmUoc2RwTGluZXMsICdtPScsICd2aWRlbycpO1xuICAgIGlmIChtTGluZUluZGV4ID09PSBudWxsKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnRmFpbGVkIHRvIGZpbmQgdmlkZW8gbS1saW5lJyk7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cbiAgICAvLyBGaWd1cmUgb3V0IHRoZSBmaXJzdCBjb2RlYyBwYXlsb2FkIHR5cGUgb24gdGhlIG09dmlkZW8gU0RQIGxpbmUuXG4gICAgY29uc3QgdmlkZW9NTGluZSA9IHNkcExpbmVzW21MaW5lSW5kZXhdO1xuICAgIGNvbnN0IHBhdHRlcm4gPSBuZXcgUmVnRXhwKCdtPXZpZGVvXFxcXHNcXFxcZCtcXFxcc1tBLVovXStcXFxccycpO1xuICAgIGNvbnN0IHNlbmRQYXlsb2FkVHlwZSA9IHZpZGVvTUxpbmUuc3BsaXQocGF0dGVybilbMV0uc3BsaXQoJyAnKVswXTtcbiAgICBjb25zdCBsaW5lID0gU2RwVXRpbHMuZmluZExpbmUoc2RwTGluZXMsICdhPXJ0cG1hcCcsIHNlbmRQYXlsb2FkVHlwZSk7XG4gICAgaWYgKCFsaW5lKSB7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cbiAgICBjb25zdCBmbXRwTGluZSA9IHNkcExpbmVzW2xpbmVdO1xuICAgIGNvbnN0IGNvZGVjTmFtZSA9IGZtdHBMaW5lLnNwbGl0KCdhPXJ0cG1hcDonICtcbiAgICAgICAgc2VuZFBheWxvYWRUeXBlKVsxXS5zcGxpdCgnLycpWzBdO1xuXG4gICAgLy8gVXNlIGNvZGVjIGZyb20gcGFyYW1zIGlmIHNwZWNpZmllZCB2aWEgVVJMIHBhcmFtLCBvdGhlcndpc2UgdXNlIGZyb20gU0RQLlxuICAgIGNvbnN0IGNvZGVjID0gcGFyYW1zLnZpZGVvU2VuZENvZGVjIHx8IGNvZGVjTmFtZTtcbiAgICBzZHAgPSBTZHBVdGlscy5zZXRDb2RlY1BhcmFtKHNkcCwgY29kZWMsICd4LWdvb2dsZS1taW4tYml0cmF0ZScsIHBhcmFtcy52aWRlb1NlbmRJbml0aWFsQml0cmF0ZS50b1N0cmluZygpKTtcbiAgICBzZHAgPSBTZHBVdGlscy5zZXRDb2RlY1BhcmFtKHNkcCwgY29kZWMsICd4LWdvb2dsZS1tYXgtYml0cmF0ZScsIG1heEJpdHJhdGUudG9TdHJpbmcoKSk7XG5cbiAgICByZXR1cm4gc2RwO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyByZW1vdmVQYXlsb2FkVHlwZUZyb21NbGluZShtTGluZTogc3RyaW5nLCBwYXlsb2FkVHlwZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBtTGluZUFycmF5ID0gbUxpbmUuc3BsaXQoJyAnKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1MaW5lQXJyYXkubGVuZ3RoOyArK2kpIHtcbiAgICAgIGlmIChtTGluZUFycmF5W2ldID09PSBwYXlsb2FkVHlwZS50b1N0cmluZygpKSB7XG4gICAgICAgIG1MaW5lQXJyYXkuc3BsaWNlKGksIDEpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbUxpbmVBcnJheS5qb2luKCcgJyk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHJlbW92ZUNvZGVjQnlOYW1lKHNkcExpbmVzOiBzdHJpbmdbXSwgY29kZWM6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBpbmRleCA9IFNkcFV0aWxzLmZpbmRMaW5lKHNkcExpbmVzLCAnYT1ydHBtYXAnLCBjb2RlYyk7XG4gICAgaWYgKGluZGV4ID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gc2RwTGluZXM7XG4gICAgfVxuICAgIGNvbnN0IHBheWxvYWRUeXBlID0gU2RwVXRpbHMuZ2V0Q29kZWNQYXlsb2FkVHlwZUZyb21MaW5lKHNkcExpbmVzW2luZGV4XSk7XG4gICAgaWYgKCFwYXlsb2FkVHlwZSkge1xuICAgICAgcmV0dXJuIHNkcExpbmVzO1xuICAgIH1cbiAgICBzZHBMaW5lcy5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgLy8gU2VhcmNoIGZvciB0aGUgdmlkZW8gbT0gbGluZSBhbmQgcmVtb3ZlIHRoZSBjb2RlYy5cbiAgICBjb25zdCBtTGluZUluZGV4ID0gU2RwVXRpbHMuZmluZExpbmUoc2RwTGluZXMsICdtPScsICd2aWRlbycpO1xuICAgIGlmIChtTGluZUluZGV4ID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gc2RwTGluZXM7XG4gICAgfVxuICAgIHNkcExpbmVzW21MaW5lSW5kZXhdID0gU2RwVXRpbHMucmVtb3ZlUGF5bG9hZFR5cGVGcm9tTWxpbmUoc2RwTGluZXNbbUxpbmVJbmRleF0sIHBheWxvYWRUeXBlKTtcbiAgICByZXR1cm4gc2RwTGluZXM7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHJlbW92ZUNvZGVjQnlQYXlsb2FkVHlwZShzZHBMaW5lczogc3RyaW5nW10sIHBheWxvYWRUeXBlOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgaW5kZXggPSBTZHBVdGlscy5maW5kTGluZShzZHBMaW5lcywgJ2E9cnRwbWFwJywgcGF5bG9hZFR5cGUudG9TdHJpbmcoKSk7XG4gICAgaWYgKGluZGV4ID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gc2RwTGluZXM7XG4gICAgfVxuICAgIHNkcExpbmVzLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAvLyBTZWFyY2ggZm9yIHRoZSB2aWRlbyBtPSBsaW5lIGFuZCByZW1vdmUgdGhlIGNvZGVjLlxuICAgIGNvbnN0IG1MaW5lSW5kZXggPSBTZHBVdGlscy5maW5kTGluZShzZHBMaW5lcywgJ209JywgJ3ZpZGVvJyk7XG4gICAgaWYgKG1MaW5lSW5kZXggPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBzZHBMaW5lcztcbiAgICB9XG4gICAgc2RwTGluZXNbbUxpbmVJbmRleF0gPSBTZHBVdGlscy5yZW1vdmVQYXlsb2FkVHlwZUZyb21NbGluZShzZHBMaW5lc1ttTGluZUluZGV4XSxcbiAgICAgICAgcGF5bG9hZFR5cGUpO1xuICAgIHJldHVybiBzZHBMaW5lcztcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbWF5YmVSZW1vdmVWaWRlb0ZlYyhzZHA6IHN0cmluZywgcGFyYW1zOiBTZHBTZXR0aW5ncyk6IHN0cmluZyB7XG4gICAgaWYgKHBhcmFtcy52aWRlb0ZlYyAhPT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBzZHA7XG4gICAgfVxuXG4gICAgbGV0IHNkcExpbmVzID0gc2RwLnNwbGl0KCdcXHJcXG4nKTtcblxuICAgIGxldCBpbmRleCA9IFNkcFV0aWxzLmZpbmRMaW5lKHNkcExpbmVzLCAnYT1ydHBtYXAnLCAncmVkJyk7XG4gICAgaWYgKGluZGV4ID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gc2RwO1xuICAgIH1cbiAgICBjb25zdCByZWRQYXlsb2FkVHlwZSA9IFNkcFV0aWxzLmdldENvZGVjUGF5bG9hZFR5cGVGcm9tTGluZShzZHBMaW5lc1tpbmRleF0pO1xuICAgIGlmIChyZWRQYXlsb2FkVHlwZSA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHNkcDtcbiAgICB9XG4gICAgc2RwTGluZXMgPSBTZHBVdGlscy5yZW1vdmVDb2RlY0J5UGF5bG9hZFR5cGUoc2RwTGluZXMsIHJlZFBheWxvYWRUeXBlKTtcbiAgICBzZHBMaW5lcyA9IFNkcFV0aWxzLnJlbW92ZUNvZGVjQnlOYW1lKHNkcExpbmVzLCAndWxwZmVjJyk7XG5cbiAgICAvLyBSZW1vdmUgZm10cCBsaW5lcyBhc3NvY2lhdGVkIHdpdGggcmVkIGNvZGVjLlxuICAgIGluZGV4ID0gU2RwVXRpbHMuZmluZExpbmUoc2RwTGluZXMsICdhPWZtdHAnLCByZWRQYXlsb2FkVHlwZS50b1N0cmluZygpKTtcbiAgICBpZiAoaW5kZXggPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBzZHA7XG4gICAgfVxuICAgIGNvbnN0IGZtdHBMaW5lID0gU2RwVXRpbHMucGFyc2VGbXRwTGluZShzZHBMaW5lc1tpbmRleF0pO1xuICAgIGNvbnN0IHJ0eFBheWxvYWRUeXBlID0gZm10cExpbmU/LnB0O1xuICAgIGlmICghcnR4UGF5bG9hZFR5cGUgfHwgcnR4UGF5bG9hZFR5cGUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBzZHA7XG4gICAgfVxuICAgIHNkcExpbmVzLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICBzZHBMaW5lcyA9IFNkcFV0aWxzLnJlbW92ZUNvZGVjQnlQYXlsb2FkVHlwZShzZHBMaW5lcywgcnR4UGF5bG9hZFR5cGUpO1xuICAgIHJldHVybiBzZHBMaW5lcy5qb2luKCdcXHJcXG4nKTtcbiAgfVxuXG4gIC8vIFByb21vdGVzIHxhdWRpb1NlbmRDb2RlY3wgdG8gYmUgdGhlIGZpcnN0IGluIHRoZSBtPWF1ZGlvIGxpbmUsIGlmIHNldC5cbiAgcHVibGljIHN0YXRpYyBtYXliZVByZWZlckF1ZGlvU2VuZENvZGVjKHNkcDogc3RyaW5nLCBwYXJhbXM6IFNkcFNldHRpbmdzKTogc3RyaW5nIHtcbiAgICByZXR1cm4gU2RwVXRpbHMubWF5YmVQcmVmZXJDb2RlYyhzZHAsICdhdWRpbycsICdzZW5kJywgcGFyYW1zLmF1ZGlvU2VuZENvZGVjKTtcbiAgfVxuXG4gIC8vIFByb21vdGVzIHxhdWRpb1JlY3ZDb2RlY3wgdG8gYmUgdGhlIGZpcnN0IGluIHRoZSBtPWF1ZGlvIGxpbmUsIGlmIHNldC5cbiAgcHVibGljIHN0YXRpYyBtYXliZVByZWZlckF1ZGlvUmVjZWl2ZUNvZGVjKHNkcDogc3RyaW5nLCBwYXJhbXM6IFNkcFNldHRpbmdzKTogc3RyaW5nIHtcbiAgICByZXR1cm4gU2RwVXRpbHMubWF5YmVQcmVmZXJDb2RlYyhzZHAsICdhdWRpbycsICdyZWNlaXZlJywgcGFyYW1zLmF1ZGlvUmVjdkNvZGVjKTtcbiAgfVxuXG4gIC8vIFByb21vdGVzIHx2aWRlb1NlbmRDb2RlY3wgdG8gYmUgdGhlIGZpcnN0IGluIHRoZSBtPWF1ZGlvIGxpbmUsIGlmIHNldC5cbiAgcHVibGljIHN0YXRpYyBtYXliZVByZWZlclZpZGVvU2VuZENvZGVjKHNkcDogc3RyaW5nLCBwYXJhbXM6IFNkcFNldHRpbmdzKTogc3RyaW5nIHtcbiAgICByZXR1cm4gU2RwVXRpbHMubWF5YmVQcmVmZXJDb2RlYyhzZHAsICd2aWRlbycsICdzZW5kJywgcGFyYW1zLnZpZGVvU2VuZENvZGVjKTtcbiAgfVxuXG4gIC8vIFByb21vdGVzIHx2aWRlb1JlY3ZDb2RlY3wgdG8gYmUgdGhlIGZpcnN0IGluIHRoZSBtPWF1ZGlvIGxpbmUsIGlmIHNldC5cbiAgcHVibGljIHN0YXRpYyBtYXliZVByZWZlclZpZGVvUmVjZWl2ZUNvZGVjKHNkcDogc3RyaW5nLCBwYXJhbXM6IFNkcFNldHRpbmdzKTogc3RyaW5nIHtcbiAgICByZXR1cm4gU2RwVXRpbHMubWF5YmVQcmVmZXJDb2RlYyhzZHAsICd2aWRlbycsICdyZWNlaXZlJywgcGFyYW1zLnZpZGVvUmVjdkNvZGVjKTtcbiAgfVxuXG4gIC8vIFNldHMgfGNvZGVjfCBhcyB0aGUgZGVmYXVsdCB8dHlwZXwgY29kZWMgaWYgaXQncyBwcmVzZW50LlxuICAvLyBUaGUgZm9ybWF0IG9mIHxjb2RlY3wgaXMgJ05BTUUvUkFURScsIGUuZy4gJ29wdXMvNDgwMDAnLlxuICBwdWJsaWMgc3RhdGljIG1heWJlUHJlZmVyQ29kZWMoc2RwOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgZGlyOiBzdHJpbmcsIGNvZGVjPzogc3RyaW5nICk6IHN0cmluZyB7XG4gICAgLy8gbGV0IHN0ciA9IHR5cGUgKyAnICcgKyBkaXIgKyAnIGNvZGVjJztcbiAgICBpZiAoIWNvZGVjKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnTm8gcHJlZmVyZW5jZSBvbiAnICsgc3RyICsgJy4nKTtcbiAgICAgIHJldHVybiBzZHA7XG4gICAgfVxuXG4gICAgLy8gY29uc29sZS5sb2coJ1ByZWZlciAnICsgc3RyICsgJzogJyArIGNvZGVjKTtcblxuICAgIGNvbnN0IHNkcExpbmVzID0gc2RwLnNwbGl0KCdcXHJcXG4nKTtcblxuICAgIC8vIFNlYXJjaCBmb3IgbSBsaW5lLlxuICAgIGNvbnN0IG1MaW5lSW5kZXggPSBTZHBVdGlscy5maW5kTGluZShzZHBMaW5lcywgJ209JywgdHlwZSk7XG4gICAgaWYgKG1MaW5lSW5kZXggPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBzZHA7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIGNvZGVjIGlzIGF2YWlsYWJsZSwgc2V0IGl0IGFzIHRoZSBkZWZhdWx0IGluIG0gbGluZS5cbiAgICBsZXQgcGF5bG9hZCA9IG51bGw7XG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIHJ0cG1hcCBlbnVtZXJhdGlvbnMgdG8gZmluZCBhbGwgbWF0Y2hpbmcgY29kZWMgZW50cmllc1xuICAgIGZvciAobGV0IGkgPSBzZHBMaW5lcy5sZW5ndGggLSAxOyBpID49IDAgOyAtLWkpIHtcbiAgICAgIC8vIEZpbmRzIGZpcnN0IG1hdGNoIGluIHJ0cG1hcFxuICAgICAgY29uc3QgaW5kZXggPSBTZHBVdGlscy5maW5kTGluZUluUmFuZ2Uoc2RwTGluZXMsIGksIDAsICdhPXJ0cG1hcCcsIGNvZGVjLCAnZGVzYycpO1xuICAgICAgaWYgKGluZGV4ICE9PSBudWxsKSB7XG4gICAgICAgIC8vIFNraXAgYWxsIG9mIHRoZSBlbnRyaWVzIGJldHdlZW4gaSBhbmQgaW5kZXggbWF0Y2hcbiAgICAgICAgaSA9IGluZGV4O1xuICAgICAgICBwYXlsb2FkID0gU2RwVXRpbHMuZ2V0Q29kZWNQYXlsb2FkVHlwZUZyb21MaW5lKHNkcExpbmVzW2luZGV4XSk7XG4gICAgICAgIGlmIChwYXlsb2FkKSB7XG4gICAgICAgICAgLy8gTW92ZSBjb2RlYyB0byB0b3BcbiAgICAgICAgICBzZHBMaW5lc1ttTGluZUluZGV4XSA9IFNkcFV0aWxzLnNldERlZmF1bHRDb2RlYyhzZHBMaW5lc1ttTGluZUluZGV4XSwgcGF5bG9hZCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE5vIG1hdGNoIG1lYW5zIHdlIGNhbiBicmVhayB0aGUgbG9vcFxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzZHAgPSBzZHBMaW5lcy5qb2luKCdcXHJcXG4nKTtcbiAgICByZXR1cm4gc2RwO1xuICB9XG5cbiAgLy8gU2V0IGZtdHAgcGFyYW0gdG8gc3BlY2lmaWMgY29kZWMgaW4gU0RQLiBJZiBwYXJhbSBkb2VzIG5vdCBleGlzdHMsIGFkZCBpdC5cbiAgcHVibGljIHN0YXRpYyBzZXRDb2RlY1BhcmFtKHNkcDogc3RyaW5nLCBjb2RlYzogc3RyaW5nLCBwYXJhbTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCBzZHBMaW5lcyA9IHNkcC5zcGxpdCgnXFxyXFxuJyk7XG5cbiAgICBjb25zdCBmbXRwTGluZUluZGV4ID0gU2RwVXRpbHMuZmluZEZtdHBMaW5lKHNkcExpbmVzLCBjb2RlYyk7XG5cbiAgICBsZXQgZm10cE9iajogRm9ybWF0T2JqZWN0IHwgbnVsbCA9IHtwdDogJycsIHBhcmFtczoge319XG4gICAgaWYgKGZtdHBMaW5lSW5kZXggPT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gU2RwVXRpbHMuZmluZExpbmUoc2RwTGluZXMsICdhPXJ0cG1hcCcsIGNvZGVjKTtcbiAgICAgIGlmIChpbmRleCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gc2RwO1xuICAgICAgfVxuICAgICAgY29uc3QgcGF5bG9hZCA9IFNkcFV0aWxzLmdldENvZGVjUGF5bG9hZFR5cGVGcm9tTGluZShzZHBMaW5lc1tpbmRleF0pO1xuICAgICAgaWYgKHBheWxvYWQgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHNkcDtcbiAgICAgIH1cbiAgICAgIGZtdHBPYmoucHQgPSBwYXlsb2FkLnRvU3RyaW5nKCk7XG4gICAgICBmbXRwT2JqLnBhcmFtcyA9IHt9O1xuICAgICAgZm10cE9iai5wYXJhbXNbcGFyYW1dID0gdmFsdWU7XG4gICAgICBjb25zdCByZXN1bHQgPSBTZHBVdGlscy53cml0ZUZtdHBMaW5lKGZtdHBPYmopO1xuICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICBzZHBMaW5lcy5zcGxpY2UoaW5kZXggKyAxLCAwLCByZXN1bHQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBmbXRwT2JqID0gU2RwVXRpbHMucGFyc2VGbXRwTGluZShzZHBMaW5lc1tmbXRwTGluZUluZGV4XSk7XG4gICAgICBpZiAoZm10cE9iaikge1xuICAgICAgICBmbXRwT2JqLnBhcmFtc1twYXJhbV0gPSB2YWx1ZTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gU2RwVXRpbHMud3JpdGVGbXRwTGluZShmbXRwT2JqKTtcbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgIHNkcExpbmVzW2ZtdHBMaW5lSW5kZXhdID0gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgc2RwID0gc2RwTGluZXMuam9pbignXFxyXFxuJyk7XG4gICAgcmV0dXJuIHNkcDtcbiAgfVxuXG4gIC8vIFJlbW92ZSBmbXRwIHBhcmFtIGlmIGl0IGV4aXN0cy5cbiAgcHVibGljIHN0YXRpYyByZW1vdmVDb2RlY1BhcmFtKHNkcDogc3RyaW5nLCBjb2RlYzogc3RyaW5nLCBwYXJhbTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBzZHBMaW5lcyA9IHNkcC5zcGxpdCgnXFxyXFxuJyk7XG5cbiAgICBjb25zdCBmbXRwTGluZUluZGV4ID0gU2RwVXRpbHMuZmluZEZtdHBMaW5lKHNkcExpbmVzLCBjb2RlYyk7XG4gICAgaWYgKGZtdHBMaW5lSW5kZXggPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBzZHA7XG4gICAgfVxuXG4gICAgY29uc3QgbWFwID0gU2RwVXRpbHMucGFyc2VGbXRwTGluZShzZHBMaW5lc1tmbXRwTGluZUluZGV4XSk7XG4gICAgaWYgKG1hcCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHNkcDtcbiAgICB9XG4gICAgZGVsZXRlIG1hcC5wYXJhbXNbcGFyYW1dO1xuXG4gICAgY29uc3QgbmV3TGluZSA9IFNkcFV0aWxzLndyaXRlRm10cExpbmUobWFwKTtcbiAgICBpZiAobmV3TGluZSA9PT0gbnVsbCkge1xuICAgICAgc2RwTGluZXMuc3BsaWNlKGZtdHBMaW5lSW5kZXgsIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZHBMaW5lc1tmbXRwTGluZUluZGV4XSA9IG5ld0xpbmU7XG4gICAgfVxuXG4gICAgc2RwID0gc2RwTGluZXMuam9pbignXFxyXFxuJyk7XG4gICAgcmV0dXJuIHNkcDtcbiAgfVxuXG4gIC8vIFNwbGl0IGFuIGZtdHAgbGluZSBpbnRvIGFuIG9iamVjdCBpbmNsdWRpbmcgJ3B0JyBhbmQgJ3BhcmFtcycuXG4gIHB1YmxpYyBzdGF0aWMgcGFyc2VGbXRwTGluZShmbXRwTGluZTogc3RyaW5nKTogbnVsbCB8IEZvcm1hdE9iamVjdCB7XG4gICAgY29uc3QgZm10cE9iajogRm9ybWF0T2JqZWN0ID0ge3B0OiAnJywgcGFyYW1zOiB7fX07XG4gICAgY29uc3Qgc3BhY2VQb3MgPSBmbXRwTGluZS5pbmRleE9mKCcgJyk7XG4gICAgY29uc3Qga2V5VmFsdWVzID0gZm10cExpbmUuc3Vic3RyaW5nKHNwYWNlUG9zICsgMSkuc3BsaXQoJzsnKTtcblxuICAgIGNvbnN0IHBhdHRlcm4gPSBuZXcgUmVnRXhwKCdhPWZtdHA6KFxcXFxkKyknKTtcbiAgICBjb25zdCByZXN1bHQgPSBmbXRwTGluZS5tYXRjaChwYXR0ZXJuKTtcbiAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggPT09IDIpIHtcbiAgICAgIGZtdHBPYmoucHQgPSByZXN1bHRbMV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHBhcmFtczogRm9ybWF0UGFyYW1zID0ge307XG4gICAgZm9yIChjb25zdCBwYWlyU3RyaW5nIG9mIGtleVZhbHVlcykge1xuICAgICAgY29uc3QgcGFpciA9IHBhaXJTdHJpbmcuc3BsaXQoJz0nKTtcbiAgICAgIGlmIChwYWlyLmxlbmd0aCA9PT0gMikge1xuICAgICAgICBwYXJhbXNbcGFpclswXV0gPSBwYWlyWzFdO1xuICAgICAgfVxuICAgIH1cbiAgICBmbXRwT2JqLnBhcmFtcyA9IHBhcmFtcztcblxuICAgIHJldHVybiBmbXRwT2JqO1xuICB9XG5cbiAgLy8gR2VuZXJhdGUgYW4gZm10cCBsaW5lIGZyb20gYW4gb2JqZWN0IGluY2x1ZGluZyAncHQnIGFuZCAncGFyYW1zJy5cbiAgcHVibGljIHN0YXRpYyB3cml0ZUZtdHBMaW5lKGZtdHBPYmo6IEZvcm1hdE9iamVjdCk6IHN0cmluZyB8IG51bGwge1xuICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGZtdHBPYmosICdwdCcpIHx8ICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZm10cE9iaiwgJ3BhcmFtcycpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgcHQgPSBmbXRwT2JqLnB0O1xuICAgIGNvbnN0IHBhcmFtcyA9IGZtdHBPYmoucGFyYW1zO1xuICAgIGNvbnN0IGtleVZhbHVlcyA9IFtdO1xuICAgIGxldCBpID0gMDtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXJhbXMpIHtcbiAgICAgIGlmIChwYXJhbXNba2V5XSkge1xuICAgICAgICBrZXlWYWx1ZXNbaV0gPSBrZXkgKyAnPScgKyBwYXJhbXNba2V5XTtcbiAgICAgICAgKytpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiAnYT1mbXRwOicgKyBwdD8udG9TdHJpbmcoKSArICcgJyArIGtleVZhbHVlcy5qb2luKCc7Jyk7XG4gIH1cblxuICAvLyBGaW5kIGZtdHAgYXR0cmlidXRlIGZvciB8Y29kZWN8IGluIHxzZHBMaW5lc3wuXG4gIHB1YmxpYyBzdGF0aWMgZmluZEZtdHBMaW5lKHNkcExpbmVzOiBzdHJpbmdbXSwgY29kZWM6IHN0cmluZyk6IG51bWJlciB8IG51bGwge1xuICAgIC8vIEZpbmQgcGF5bG9hZCBvZiBjb2RlYy5cbiAgICBjb25zdCBwYXlsb2FkID0gU2RwVXRpbHMuZ2V0Q29kZWNQYXlsb2FkVHlwZShzZHBMaW5lcywgY29kZWMpO1xuICAgIC8vIEZpbmQgdGhlIHBheWxvYWQgaW4gZm10cCBsaW5lLlxuICAgIHJldHVybiBwYXlsb2FkID8gU2RwVXRpbHMuZmluZExpbmUoc2RwTGluZXMsICdhPWZtdHA6JyArIHBheWxvYWQudG9TdHJpbmcoKSkgOiBudWxsO1xuICB9XG5cbiAgLy8gRmluZCB0aGUgbGluZSBpbiBzZHBMaW5lcyB0aGF0IHN0YXJ0cyB3aXRoIHxwcmVmaXh8LCBhbmQsIGlmIHNwZWNpZmllZCxcbiAgLy8gY29udGFpbnMgfHN1YnN0cnwgKGNhc2UtaW5zZW5zaXRpdmUgc2VhcmNoKS5cbiAgcHVibGljIHN0YXRpYyBmaW5kTGluZShzZHBMaW5lczogc3RyaW5nW10sIHByZWZpeDogc3RyaW5nLCBzdWJzdHI/OiBzdHJpbmcpOiBudW1iZXIgfCBudWxsIHtcbiAgICByZXR1cm4gU2RwVXRpbHMuZmluZExpbmVJblJhbmdlKHNkcExpbmVzLCAwLCAtMSwgcHJlZml4LCBzdWJzdHIpO1xuICB9XG5cbiAgLy8gRmluZCB0aGUgbGluZSBpbiBzZHBMaW5lc1tzdGFydExpbmUuLi5lbmRMaW5lIC0gMV0gdGhhdCBzdGFydHMgd2l0aCB8cHJlZml4fFxuICAvLyBhbmQsIGlmIHNwZWNpZmllZCwgY29udGFpbnMgfHN1YnN0cnwgKGNhc2UtaW5zZW5zaXRpdmUgc2VhcmNoKS5cbiAgcHVibGljIHN0YXRpYyBmaW5kTGluZUluUmFuZ2UoXG4gICAgc2RwTGluZXM6IHN0cmluZ1tdLFxuICAgIHN0YXJ0TGluZTogbnVtYmVyLFxuICAgIGVuZExpbmU6IG51bWJlcixcbiAgICBwcmVmaXg/OiBzdHJpbmcsXG4gICAgc3Vic3RyPzogc3RyaW5nLFxuICAgIGRpcmVjdGlvbj86ICdhc2MnIHwgJ2Rlc2MnXG4gICk6IG51bWJlciB8IG51bGwge1xuICAgIGlmIChkaXJlY3Rpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgZGlyZWN0aW9uID0gJ2FzYyc7XG4gICAgfVxuXG4gICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uIHx8ICdhc2MnO1xuXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2FzYycpIHtcbiAgICAgIC8vIFNlYXJjaCBiZWdpbm5pbmcgdG8gZW5kXG4gICAgICBjb25zdCByZWFsRW5kTGluZSA9IGVuZExpbmUgIT09IC0xID8gZW5kTGluZSA6IHNkcExpbmVzLmxlbmd0aDtcbiAgICAgIGZvciAobGV0IGkgPSBzdGFydExpbmU7IGkgPCByZWFsRW5kTGluZTsgKytpKSB7XG4gICAgICAgIGlmIChwcmVmaXggJiYgc2RwTGluZXNbaV0uaW5kZXhPZihwcmVmaXgpID09PSAwKSB7XG4gICAgICAgICAgaWYgKCFzdWJzdHIgfHxcbiAgICAgICAgICAgICAgc2RwTGluZXNbaV0udG9Mb3dlckNhc2UoKS5pbmRleE9mKHN1YnN0ci50b0xvd2VyQ2FzZSgpKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBTZWFyY2ggZW5kIHRvIGJlZ2lubmluZ1xuICAgICAgY29uc3QgcmVhbFN0YXJ0TGluZSA9IHN0YXJ0TGluZSAhPT0gLTEgPyBzdGFydExpbmUgOiBzZHBMaW5lcy5sZW5ndGggLSAxO1xuICAgICAgZm9yIChsZXQgaiA9IHJlYWxTdGFydExpbmU7IGogPj0gMDsgLS1qKSB7XG4gICAgICAgIGlmIChwcmVmaXggJiYgc2RwTGluZXNbal0uaW5kZXhPZihwcmVmaXgpID09PSAwKSB7XG4gICAgICAgICAgaWYgKCFzdWJzdHIgfHxcbiAgICAgICAgICAgICAgc2RwTGluZXNbal0udG9Mb3dlckNhc2UoKS5pbmRleE9mKHN1YnN0ci50b0xvd2VyQ2FzZSgpKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBqO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8vIEdldHMgdGhlIGNvZGVjIHBheWxvYWQgdHlwZSBmcm9tIHNkcCBsaW5lcy5cbiAgcHVibGljIHN0YXRpYyBnZXRDb2RlY1BheWxvYWRUeXBlKHNkcExpbmVzOiBzdHJpbmdbXSwgY29kZWM6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xuICAgIGNvbnN0IGluZGV4ID0gU2RwVXRpbHMuZmluZExpbmUoc2RwTGluZXMsICdhPXJ0cG1hcCcsIGNvZGVjKTtcbiAgICByZXR1cm4gaW5kZXggPyBTZHBVdGlscy5nZXRDb2RlY1BheWxvYWRUeXBlRnJvbUxpbmUoc2RwTGluZXNbaW5kZXhdKSA6IG51bGw7XG4gIH1cblxuICAvLyBHZXRzIHRoZSBjb2RlYyBwYXlsb2FkIHR5cGUgZnJvbSBhbiBhPXJ0cG1hcDpYIGxpbmUuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0Q29kZWNQYXlsb2FkVHlwZUZyb21MaW5lKHNkcExpbmU6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xuICAgIGNvbnN0IHBhdHRlcm4gPSBuZXcgUmVnRXhwKCdhPXJ0cG1hcDooXFxcXGQrKSBbYS16QS1aMC05LV0rXFxcXC9cXFxcZCsnKTtcbiAgICBjb25zdCByZXN1bHQgPSBzZHBMaW5lLm1hdGNoKHBhdHRlcm4pO1xuICAgIHJldHVybiAocmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggPT09IDIpID8gcmVzdWx0WzFdIDogbnVsbDtcbiAgfVxuXG4gIC8vIFJldHVybnMgYSBuZXcgbT0gbGluZSB3aXRoIHRoZSBzcGVjaWZpZWQgY29kZWMgYXMgdGhlIGZpcnN0IG9uZS5cbiAgcHVibGljIHN0YXRpYyBzZXREZWZhdWx0Q29kZWMobUxpbmU6IHN0cmluZywgcGF5bG9hZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBlbGVtZW50cyA9IG1MaW5lLnNwbGl0KCcgJyk7XG5cbiAgICAvLyBKdXN0IGNvcHkgdGhlIGZpcnN0IHRocmVlIHBhcmFtZXRlcnM7IGNvZGVjIG9yZGVyIHN0YXJ0cyBvbiBmb3VydGguXG4gICAgY29uc3QgbmV3TGluZSA9IGVsZW1lbnRzLnNsaWNlKDAsIDMpO1xuXG4gICAgLy8gUHV0IHRhcmdldCBwYXlsb2FkIGZpcnN0IGFuZCBjb3B5IGluIHRoZSByZXN0LlxuICAgIG5ld0xpbmUucHVzaChwYXlsb2FkKTtcbiAgICBmb3IgKGxldCBpID0gMzsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoZWxlbWVudHNbaV0gIT09IHBheWxvYWQpIHtcbiAgICAgICAgbmV3TGluZS5wdXNoKGVsZW1lbnRzW2ldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ld0xpbmUuam9pbignICcpO1xuICB9XG5cblxufVxuIl19