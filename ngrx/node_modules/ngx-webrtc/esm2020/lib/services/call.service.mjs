import { EventEmitter, Inject, Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { PeerConnectionClient } from '../peer-connection-client';
import { Configuration } from '../ngx-webrtc-configuration';
import { NGX_WEBRTC_STORAGE } from '../ngx-webrtc-storage';
import * as i0 from "@angular/core";
import * as i1 from "../ngx-webrtc-configuration";
/**
 * The CallService holds the state of the peer connection. It provides methods to update the state
 * and methods to create a `PeerConnectionClient`.
 */
export class CallService {
    constructor(config, storage) {
        this.config = config;
        this.storage = storage;
        this.storage_key_since = 'ngx-webrtc-since';
        this.since = 0;
        // TODO: add option to configure this
        this.identifier = this.config.userIdentifier;
        /**
         * users in call state, add user via `CallService.addUser(User,...)` and remove user via `CallService.removeUser(User)`.
         * get all User via `CallService.getUsers()`, get one user via `CallService.getUser()`.
         */
        this.users$ = new BehaviorSubject([]);
        /**
         * Emitted by `ShareScreenDirective` when current User starts sharing his screen.
         */
        this.startShareScreen = new EventEmitter();
        /**
         * Emitted by `ShareScreenDirective` when current User stops sharing his screen.
         */
        this.stopShareScreen = new EventEmitter();
        /**
         * default public and free IceServers list
         * ```json
         * [
         *  { urls: 'stun:stun.l.google.com:19302' },
         *  { urls: 'stun:global.stun.twilio.com:3478?transport=udp' },
         *  { urls: 'stun:stun.services.mozilla.com' },
         * ]
         *
         * ```
         */
        this.defaultServers = [
            { urls: 'stun:stun.l.google.com:19302' },
            { urls: 'stun:global.stun.twilio.com:3478?transport=udp' },
            { urls: 'stun:stun.services.mozilla.com' },
        ];
        /**
         * chat status state
         */
        this.started$ = new BehaviorSubject(false);
    }
    /**
     * update since timestamp with current time
     */
    updateSince() {
        this.since = Date.now();
        // TODO: make storage customizable via provider
        window[this.storage].setItem(this.storage_key_since, `${this.since}`);
    }
    /**
     * get current since timestamp set by `CallService.updateSince()`
     * @returns Timestamp
     */
    getSince() {
        const storageSince = window[this.storage].getItem(this.storage_key_since);
        if (!this.since && storageSince && storageSince !== null) {
            this.since = parseInt(storageSince, 10);
        }
        return this.since;
    }
    /**
     * The `CallService` hold the users state with all users, with this methode you can add a user to the state.
     * @param user User object that contains userIdentifier
     * @param connection created connection for the user
     * @param node component that is used to display the users webcam, etc.
     */
    addUser(user, connection, node) {
        const users = this.getUsers();
        users.push({
            user,
            hasCam: false,
            hasMic: false,
            volume: 1,
            audioMuted: false,
            videoMuted: false,
            shareScreen: false,
            connection,
            node
        });
        this.users$.next(users);
    }
    /**
     * remove a user object from state
     * @param user User object to remove
     */
    removeUser(user) {
        let users = this.getUsers();
        users = users.filter(e => e.user[this.identifier] !== user[this.identifier]);
        this.users$.next(users);
    }
    /**
     * Use this method if the passed user has a camera to update the state.
     * @param user User to update
     */
    userHasCam(user) {
        const users = this.getUsers();
        const currentUser = this.findUser(users, user);
        if (currentUser) {
            currentUser.hasCam = true;
            this.users$.next(users);
        }
    }
    /**
     * Use this method if the passed user has a microphone to update the state.
     * @param user
     */
    userHasMic(user) {
        const users = this.getUsers();
        const currentUser = this.findUser(users, user);
        if (currentUser) {
            currentUser.hasMic = true;
            this.users$.next(users);
        }
    }
    /**
     * Use this method when the passed user deactivates his microphone to update the state.
     * @param user
     */
    userAudioMuted(user) {
        const users = this.getUsers();
        const currentUser = this.findUser(users, user);
        if (currentUser) {
            currentUser.audioMuted = true;
            this.users$.next(users);
        }
    }
    /**
     * Use this method when the passed user activates his microphone to update the state.
     * @param user
     */
    userAudioUnmuted(user) {
        const users = this.getUsers();
        const currentUser = this.findUser(users, user);
        if (currentUser) {
            currentUser.audioMuted = false;
            this.users$.next(users);
        }
    }
    /**
     * Use this method when the passed user deactivates his camera to update the state.
     * @param user
     */
    userVideoMuted(user) {
        const users = this.getUsers();
        const currentUser = this.findUser(users, user);
        if (currentUser) {
            currentUser.videoMuted = true;
            this.users$.next(users);
        }
    }
    /**
     * Use this method when the passed user activates his camera to update the state.
     * @param user
     */
    userVideoUnmuted(user) {
        const users = this.getUsers();
        const currentUser = this.findUser(users, user);
        if (currentUser) {
            currentUser.videoMuted = false;
            this.users$.next(users);
        }
    }
    /**
     * Use this method when the passed user starts to share his screen to update the state.
     * @param user
     */
    userStartShareScreen(user) {
        const users = this.getUsers();
        const currentUser = this.findUser(users, user);
        if (currentUser) {
            currentUser.shareScreen = true;
            this.users$.next(users);
        }
    }
    /**
     * Use this method when the passed user stops sharing his screen to update the state.
     * @param user
     */
    userStopShareScreen(user) {
        const users = this.getUsers();
        const currentUser = this.findUser(users, user);
        if (currentUser) {
            currentUser.shareScreen = false;
            this.users$.next(users);
        }
        this.users$.next(users);
    }
    /**
     * Give all users who are currently in the state.
     * @returns All users currently in state
     */
    getUsers() {
        return this.users$.getValue();
    }
    /**
     *
     * @param user User with `userIdentifier`
     * @returns User in state
     */
    getUser(user) {
        return this.getUsers().find(e => e.user[this.identifier] === user[this.identifier]) || null;
    }
    /**
     * Create a new `PeerConnectionClient` with the given settings
     * @param settings Settings for creating the `PeerConnectionClient`
     * @returns `PeerConnectionClient` object
     */
    async createPeerClient(settings) {
        return new PeerConnectionClient(settings);
    }
    /**
     * With this methode you can create a RTCCertificate to secure a connection.
     * @link https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/generateCertificate
     * @param algorithm Certificate options used by `RTCPeerConnection.generateCertificate()` Default algorithm `ECDSA` with curve `P-256`
     * @returns Promise resolve to `RTCCertificate`
     */
    async createCertifcate(algorithm = {
        name: 'ECDSA',
        namedCurve: 'P-256'
    }) {
        return RTCPeerConnection.generateCertificate(algorithm);
    }
    /**
     * set call state started to `true`, you can subscribe to `CallService.started$` for updates.
     */
    start() {
        this.started$.next(true);
    }
    /**
     * set call state started to `false`, you can subscribe to `CallService.started$` for updates.
     */
    stop() {
        this.started$.next(false);
    }
    /**
     * Configured user identifier.
     * @returns identifier to select a User
     */
    getUserIdentifier() {
        return this.identifier;
    }
    findUser(users, user) {
        return users.find(e => e.user[this.identifier] === user[this.identifier]) || null;
    }
}
CallService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.2.1", ngImport: i0, type: CallService, deps: [{ token: i1.Configuration }, { token: NGX_WEBRTC_STORAGE }], target: i0.ɵɵFactoryTarget.Injectable });
CallService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.2.1", ngImport: i0, type: CallService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.2.1", ngImport: i0, type: CallService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.Configuration }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [NGX_WEBRTC_STORAGE]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsbC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3gtd2VicnRjL3NyYy9saWIvc2VydmljZXMvY2FsbC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBZ0IsWUFBWSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUd2QyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUdqRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFNUQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7OztBQUUzRDs7O0dBR0c7QUFJSCxNQUFNLE9BQU8sV0FBVztJQUV0QixZQUNtQixNQUFxQixFQUNPLE9BQTBDO1FBRHRFLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDTyxZQUFPLEdBQVAsT0FBTyxDQUFtQztRQUl4RSxzQkFBaUIsR0FBRyxrQkFBa0IsQ0FBQztRQUNoRCxVQUFLLEdBQUcsQ0FBQyxDQUFDO1FBRWxCLHFDQUFxQztRQUM3QixlQUFVLEdBQWlCLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBOEIsQ0FBQztRQUU5RTs7O1dBR0c7UUFDSSxXQUFNLEdBQUcsSUFBSSxlQUFlLENBQWUsRUFBRSxDQUFDLENBQUM7UUFJdEQ7O1dBRUc7UUFDSSxxQkFBZ0IsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBR25EOztXQUVHO1FBQ0ksb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBRWxEOzs7Ozs7Ozs7O1dBVUc7UUFDSSxtQkFBYyxHQUFnQjtZQUNuQyxFQUFFLElBQUksRUFBRSw4QkFBOEIsRUFBRTtZQUN4QyxFQUFFLElBQUksRUFBRSxnREFBZ0QsRUFBRTtZQUMxRCxFQUFFLElBQUksRUFBRSxnQ0FBZ0MsRUFBRTtTQUMzQyxDQUFDO1FBRUY7O1dBRUc7UUFDSSxhQUFRLEdBQUcsSUFBSSxlQUFlLENBQVUsS0FBSyxDQUFDLENBQUM7SUFoRHBELENBQUM7SUFrREg7O09BRUc7SUFDSSxXQUFXO1FBQ2hCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3hCLCtDQUErQztRQUMvQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUN4RSxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksUUFBUTtRQUNiLE1BQU0sWUFBWSxHQUFrQixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUN6RixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxZQUFZLElBQUksWUFBWSxLQUFLLElBQUksRUFBRTtZQUN4RCxJQUFJLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7U0FDekM7UUFDRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDcEIsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0ksT0FBTyxDQUFDLElBQVUsRUFBRSxVQUFnQyxFQUFFLElBQWlEO1FBQzVHLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM5QixLQUFLLENBQUMsSUFBSSxDQUFDO1lBQ1QsSUFBSTtZQUNKLE1BQU0sRUFBRSxLQUFLO1lBQ2IsTUFBTSxFQUFFLEtBQUs7WUFDYixNQUFNLEVBQUUsQ0FBQztZQUNULFVBQVUsRUFBRSxLQUFLO1lBQ2pCLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLFdBQVcsRUFBRSxLQUFLO1lBQ2xCLFVBQVU7WUFDVixJQUFJO1NBQ0wsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVEOzs7T0FHRztJQUNJLFVBQVUsQ0FBQyxJQUFVO1FBQzFCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QixLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUM3RSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksVUFBVSxDQUFDLElBQVU7UUFDMUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzlCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQy9DLElBQUksV0FBVyxFQUFFO1lBQ2YsV0FBVyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDekI7SUFDSCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksVUFBVSxDQUFDLElBQVU7UUFDMUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzlCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQy9DLElBQUksV0FBVyxFQUFFO1lBQ2YsV0FBVyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDekI7SUFDSCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksY0FBYyxDQUFDLElBQVU7UUFDOUIs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QyxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3VzZXInO1xuaW1wb3J0IHsgUmVtb3RlUGVlckNvbXBvbmVudEludGVyZmFjZSB9IGZyb20gJy4uL2ludGVyZmFjZXMvcmVtb3RlLXBlZXItY29tcG9uZW50LWludGVyZmFjZSc7XG5pbXBvcnQgeyBQZWVyQ29ubmVjdGlvbkNsaWVudCB9IGZyb20gJy4uL3BlZXItY29ubmVjdGlvbi1jbGllbnQnO1xuaW1wb3J0IHsgUGVlckNvbm5lY3Rpb25DbGllbnRTZXR0aW5ncyB9IGZyb20gXCIuLi9pbnRlcmZhY2VzL3BlZXItY29ubmVjdGlvbi1jbGllbnQtc2V0dGluZ3NcIjtcbmltcG9ydCB7IFVzZXJJbkNhbGwgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3VzZXItaW4tY2FsbCc7XG5pbXBvcnQgeyBDb25maWd1cmF0aW9uIH0gZnJvbSAnLi4vbmd4LXdlYnJ0Yy1jb25maWd1cmF0aW9uJztcbmltcG9ydCB7IEljZVNlcnZlciB9IGZyb20gJy4uL2ludGVyZmFjZXMvaWNlLXNlcnZlcic7XG5pbXBvcnQgeyBOR1hfV0VCUlRDX1NUT1JBR0UgfSBmcm9tICcuLi9uZ3gtd2VicnRjLXN0b3JhZ2UnO1xuXG4vKipcbiAqIFRoZSBDYWxsU2VydmljZSBob2xkcyB0aGUgc3RhdGUgb2YgdGhlIHBlZXIgY29ubmVjdGlvbi4gSXQgcHJvdmlkZXMgbWV0aG9kcyB0byB1cGRhdGUgdGhlIHN0YXRlXG4gKiBhbmQgbWV0aG9kcyB0byBjcmVhdGUgYSBgUGVlckNvbm5lY3Rpb25DbGllbnRgLlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBDYWxsU2VydmljZSB7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBjb25maWc6IENvbmZpZ3VyYXRpb24sXG4gICAgQEluamVjdChOR1hfV0VCUlRDX1NUT1JBR0UpIHByaXZhdGUgcmVhZG9ubHkgc3RvcmFnZTogJ2xvY2FsU3RvcmFnZScgfCAnc2Vzc2lvblN0b3JhZ2UnLFxuICApe31cblxuXG4gIHByaXZhdGUgcmVhZG9ubHkgc3RvcmFnZV9rZXlfc2luY2UgPSAnbmd4LXdlYnJ0Yy1zaW5jZSc7XG4gIHByaXZhdGUgc2luY2UgPSAwO1xuXG4gIC8vIFRPRE86IGFkZCBvcHRpb24gdG8gY29uZmlndXJlIHRoaXNcbiAgcHJpdmF0ZSBpZGVudGlmaWVyOiAoa2V5b2YgVXNlcikgPSB0aGlzLmNvbmZpZy51c2VySWRlbnRpZmllciBhcyAoa2V5b2YgVXNlcik7XG4gIFxuICAvKipcbiAgICogdXNlcnMgaW4gY2FsbCBzdGF0ZSwgYWRkIHVzZXIgdmlhIGBDYWxsU2VydmljZS5hZGRVc2VyKFVzZXIsLi4uKWAgYW5kIHJlbW92ZSB1c2VyIHZpYSBgQ2FsbFNlcnZpY2UucmVtb3ZlVXNlcihVc2VyKWAuXG4gICAqIGdldCBhbGwgVXNlciB2aWEgYENhbGxTZXJ2aWNlLmdldFVzZXJzKClgLCBnZXQgb25lIHVzZXIgdmlhIGBDYWxsU2VydmljZS5nZXRVc2VyKClgLlxuICAgKi9cbiAgcHVibGljIHVzZXJzJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VXNlckluQ2FsbFtdPihbXSk7XG5cblxuXG4gIC8qKlxuICAgKiBFbWl0dGVkIGJ5IGBTaGFyZVNjcmVlbkRpcmVjdGl2ZWAgd2hlbiBjdXJyZW50IFVzZXIgc3RhcnRzIHNoYXJpbmcgaGlzIHNjcmVlbi4gXG4gICAqL1xuICBwdWJsaWMgc3RhcnRTaGFyZVNjcmVlbiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgXG4gIFxuICAvKipcbiAgICogRW1pdHRlZCBieSBgU2hhcmVTY3JlZW5EaXJlY3RpdmVgIHdoZW4gY3VycmVudCBVc2VyIHN0b3BzIHNoYXJpbmcgaGlzIHNjcmVlbi4gXG4gICAqL1xuICBwdWJsaWMgc3RvcFNoYXJlU2NyZWVuID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBcbiAgLyoqXG4gICAqIGRlZmF1bHQgcHVibGljIGFuZCBmcmVlIEljZVNlcnZlcnMgbGlzdFxuICAgKiBgYGBqc29uXG4gICAqIFtcbiAgICogIHsgdXJsczogJ3N0dW46c3R1bi5sLmdvb2dsZS5jb206MTkzMDInIH0sXG4gICAqICB7IHVybHM6ICdzdHVuOmdsb2JhbC5zdHVuLnR3aWxpby5jb206MzQ3OD90cmFuc3BvcnQ9dWRwJyB9LFxuICAgKiAgeyB1cmxzOiAnc3R1bjpzdHVuLnNlcnZpY2VzLm1vemlsbGEuY29tJyB9LFxuICAgKiBdXG4gICAqXG4gICAqIGBgYFxuICAgKi9cbiAgcHVibGljIGRlZmF1bHRTZXJ2ZXJzOiBJY2VTZXJ2ZXJbXSA9IFtcbiAgICB7IHVybHM6ICdzdHVuOnN0dW4ubC5nb29nbGUuY29tOjE5MzAyJyB9LFxuICAgIHsgdXJsczogJ3N0dW46Z2xvYmFsLnN0dW4udHdpbGlvLmNvbTozNDc4P3RyYW5zcG9ydD11ZHAnIH0sXG4gICAgeyB1cmxzOiAnc3R1bjpzdHVuLnNlcnZpY2VzLm1vemlsbGEuY29tJyB9LFxuICBdO1xuXG4gIC8qKlxuICAgKiBjaGF0IHN0YXR1cyBzdGF0ZVxuICAgKi9cbiAgcHVibGljIHN0YXJ0ZWQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihmYWxzZSk7XG5cbiAgLyoqXG4gICAqIHVwZGF0ZSBzaW5jZSB0aW1lc3RhbXAgd2l0aCBjdXJyZW50IHRpbWVcbiAgICovXG4gIHB1YmxpYyB1cGRhdGVTaW5jZSgpOiB2b2lkIHtcbiAgICB0aGlzLnNpbmNlID0gRGF0ZS5ub3coKTtcbiAgICAvLyBUT0RPOiBtYWtlIHN0b3JhZ2UgY3VzdG9taXphYmxlIHZpYSBwcm92aWRlclxuICAgIHdpbmRvd1t0aGlzLnN0b3JhZ2VdLnNldEl0ZW0odGhpcy5zdG9yYWdlX2tleV9zaW5jZSwgYCR7dGhpcy5zaW5jZX1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBnZXQgY3VycmVudCBzaW5jZSB0aW1lc3RhbXAgc2V0IGJ5IGBDYWxsU2VydmljZS51cGRhdGVTaW5jZSgpYFxuICAgKiBAcmV0dXJucyBUaW1lc3RhbXBcbiAgICovXG4gIHB1YmxpYyBnZXRTaW5jZSgpOiBudW1iZXIge1xuICAgIGNvbnN0IHN0b3JhZ2VTaW5jZTogc3RyaW5nIHwgbnVsbCA9IHdpbmRvd1t0aGlzLnN0b3JhZ2VdLmdldEl0ZW0odGhpcy5zdG9yYWdlX2tleV9zaW5jZSk7XG4gICAgaWYgKCF0aGlzLnNpbmNlICYmIHN0b3JhZ2VTaW5jZSAmJiBzdG9yYWdlU2luY2UgIT09IG51bGwpIHtcbiAgICAgIHRoaXMuc2luY2UgPSBwYXJzZUludChzdG9yYWdlU2luY2UsIDEwKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc2luY2U7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGBDYWxsU2VydmljZWAgaG9sZCB0aGUgdXNlcnMgc3RhdGUgd2l0aCBhbGwgdXNlcnMsIHdpdGggdGhpcyBtZXRob2RlIHlvdSBjYW4gYWRkIGEgdXNlciB0byB0aGUgc3RhdGUuXG4gICAqIEBwYXJhbSB1c2VyIFVzZXIgb2JqZWN0IHRoYXQgY29udGFpbnMgdXNlcklkZW50aWZpZXJcbiAgICogQHBhcmFtIGNvbm5lY3Rpb24gY3JlYXRlZCBjb25uZWN0aW9uIGZvciB0aGUgdXNlciBcbiAgICogQHBhcmFtIG5vZGUgY29tcG9uZW50IHRoYXQgaXMgdXNlZCB0byBkaXNwbGF5IHRoZSB1c2VycyB3ZWJjYW0sIGV0Yy5cbiAgICovXG4gIHB1YmxpYyBhZGRVc2VyKHVzZXI6IFVzZXIsIGNvbm5lY3Rpb246IFBlZXJDb25uZWN0aW9uQ2xpZW50LCBub2RlPzogQ29tcG9uZW50UmVmPFJlbW90ZVBlZXJDb21wb25lbnRJbnRlcmZhY2U+KTogdm9pZCB7XG4gICAgY29uc3QgdXNlcnMgPSB0aGlzLmdldFVzZXJzKCk7XG4gICAgdXNlcnMucHVzaCh7XG4gICAgICB1c2VyLFxuICAgICAgaGFzQ2FtOiBmYWxzZSxcbiAgICAgIGhhc01pYzogZmFsc2UsXG4gICAgICB2b2x1bWU6IDEsXG4gICAgICBhdWRpb011dGVkOiBmYWxzZSxcbiAgICAgIHZpZGVvTXV0ZWQ6IGZhbHNlLFxuICAgICAgc2hhcmVTY3JlZW46IGZhbHNlLFxuICAgICAgY29ubmVjdGlvbixcbiAgICAgIG5vZGVcbiAgICB9KTtcbiAgICB0aGlzLnVzZXJzJC5uZXh0KHVzZXJzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiByZW1vdmUgYSB1c2VyIG9iamVjdCBmcm9tIHN0YXRlXG4gICAqIEBwYXJhbSB1c2VyIFVzZXIgb2JqZWN0IHRvIHJlbW92ZVxuICAgKi9cbiAgcHVibGljIHJlbW92ZVVzZXIodXNlcjogVXNlcik6IHZvaWQge1xuICAgIGxldCB1c2VycyA9IHRoaXMuZ2V0VXNlcnMoKTtcbiAgICB1c2VycyA9IHVzZXJzLmZpbHRlcihlID0+IGUudXNlclt0aGlzLmlkZW50aWZpZXJdICE9PSB1c2VyW3RoaXMuaWRlbnRpZmllcl0pO1xuICAgIHRoaXMudXNlcnMkLm5leHQodXNlcnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZSB0aGlzIG1ldGhvZCBpZiB0aGUgcGFzc2VkIHVzZXIgaGFzIGEgY2FtZXJhIHRvIHVwZGF0ZSB0aGUgc3RhdGUuXG4gICAqIEBwYXJhbSB1c2VyIFVzZXIgdG8gdXBkYXRlXG4gICAqL1xuICBwdWJsaWMgdXNlckhhc0NhbSh1c2VyOiBVc2VyKTogdm9pZCB7XG4gICAgY29uc3QgdXNlcnMgPSB0aGlzLmdldFVzZXJzKCk7XG4gICAgY29uc3QgY3VycmVudFVzZXIgPSB0aGlzLmZpbmRVc2VyKHVzZXJzLCB1c2VyKTtcbiAgICBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgIGN1cnJlbnRVc2VyLmhhc0NhbSA9IHRydWU7XG4gICAgICB0aGlzLnVzZXJzJC5uZXh0KHVzZXJzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXNlIHRoaXMgbWV0aG9kIGlmIHRoZSBwYXNzZWQgdXNlciBoYXMgYSBtaWNyb3Bob25lIHRvIHVwZGF0ZSB0aGUgc3RhdGUuXG4gICAqIEBwYXJhbSB1c2VyIFxuICAgKi9cbiAgcHVibGljIHVzZXJIYXNNaWModXNlcjogVXNlcik6IHZvaWQge1xuICAgIGNvbnN0IHVzZXJzID0gdGhpcy5nZXRVc2VycygpO1xuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gdGhpcy5maW5kVXNlcih1c2VycywgdXNlcik7XG4gICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICBjdXJyZW50VXNlci5oYXNNaWMgPSB0cnVlO1xuICAgICAgdGhpcy51c2VycyQubmV4dCh1c2Vycyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVzZSB0aGlzIG1ldGhvZCB3aGVuIHRoZSBwYXNzZWQgdXNlciBkZWFjdGl2YXRlcyBoaXMgbWljcm9waG9uZSB0byB1cGRhdGUgdGhlIHN0YXRlLlxuICAgKiBAcGFyYW0gdXNlciBcbiAgICovXG4gIHB1YmxpYyB1c2VyQXVkaW9NdXRlZCh1c2VyOiBVc2VyKTogdm9pZCB7XG4gICAgY29uc3QgdXNlcnMgPSB0aGlzLmdldFVzZXJzKCk7XG4gICAgY29uc3QgY3VycmVudFVzZXIgPSB0aGlzLmZpbmRVc2VyKHVzZXJzLCB1c2VyKTtcbiAgICBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgIGN1cnJlbnRVc2VyLmF1ZGlvTXV0ZWQgPSB0cnVlO1xuICAgICAgdGhpcy51c2VycyQubmV4dCh1c2Vycyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVzZSB0aGlzIG1ldGhvZCB3aGVuIHRoZSBwYXNzZWQgdXNlciBhY3RpdmF0ZXMgaGlzIG1pY3JvcGhvbmUgdG8gdXBkYXRlIHRoZSBzdGF0ZS5cbiAgICogQHBhcmFtIHVzZXIgXG4gICAqL1xuICBwdWJsaWMgdXNlckF1ZGlvVW5tdXRlZCh1c2VyOiBVc2VyKTogdm9pZCB7XG4gICAgY29uc3QgdXNlcnMgPSB0aGlzLmdldFVzZXJzKCk7XG4gICAgY29uc3QgY3VycmVudFVzZXIgPSB0aGlzLmZpbmRVc2VyKHVzZXJzLCB1c2VyKTtcbiAgICBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgIGN1cnJlbnRVc2VyLmF1ZGlvTXV0ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMudXNlcnMkLm5leHQodXNlcnMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVc2UgdGhpcyBtZXRob2Qgd2hlbiB0aGUgcGFzc2VkIHVzZXIgZGVhY3RpdmF0ZXMgaGlzIGNhbWVyYSB0byB1cGRhdGUgdGhlIHN0YXRlLlxuICAgKiBAcGFyYW0gdXNlciBcbiAgICovXG4gIHB1YmxpYyB1c2VyVmlkZW9NdXRlZCh1c2VyOiBVc2VyKTogdm9pZCB7XG4gICAgY29uc3QgdXNlcnMgPSB0aGlzLmdldFVzZXJzKCk7XG4gICAgY29uc3QgY3VycmVudFVzZXIgPSB0aGlzLmZpbmRVc2VyKHVzZXJzLCB1c2VyKTtcbiAgICBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgIGN1cnJlbnRVc2VyLnZpZGVvTXV0ZWQgPSB0cnVlO1xuICAgICAgdGhpcy51c2VycyQubmV4dCh1c2Vycyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVzZSB0aGlzIG1ldGhvZCB3aGVuIHRoZSBwYXNzZWQgdXNlciBhY3RpdmF0ZXMgaGlzIGNhbWVyYSB0byB1cGRhdGUgdGhlIHN0YXRlLlxuICAgKiBAcGFyYW0gdXNlciBcbiAgICovXG4gIHB1YmxpYyB1c2VyVmlkZW9Vbm11dGVkKHVzZXI6IFVzZXIpOiB2b2lkIHtcbiAgICBjb25zdCB1c2VycyA9IHRoaXMuZ2V0VXNlcnMoKTtcbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHRoaXMuZmluZFVzZXIodXNlcnMsIHVzZXIpO1xuICAgIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgY3VycmVudFVzZXIudmlkZW9NdXRlZCA9IGZhbHNlO1xuICAgICAgdGhpcy51c2VycyQubmV4dCh1c2Vycyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVzZSB0aGlzIG1ldGhvZCB3aGVuIHRoZSBwYXNzZWQgdXNlciBzdGFydHMgdG8gc2hhcmUgaGlzIHNjcmVlbiB0byB1cGRhdGUgdGhlIHN0YXRlLlxuICAgKiBAcGFyYW0gdXNlciBcbiAgICovXG4gIHB1YmxpYyB1c2VyU3RhcnRTaGFyZVNjcmVlbih1c2VyOiBVc2VyKTogdm9pZCB7XG4gICAgY29uc3QgdXNlcnMgPSB0aGlzLmdldFVzZXJzKCk7XG4gICAgY29uc3QgY3VycmVudFVzZXIgPSB0aGlzLmZpbmRVc2VyKHVzZXJzLCB1c2VyKTtcbiAgICBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgIGN1cnJlbnRVc2VyLnNoYXJlU2NyZWVuID0gdHJ1ZTtcbiAgICAgIHRoaXMudXNlcnMkLm5leHQodXNlcnMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVc2UgdGhpcyBtZXRob2Qgd2hlbiB0aGUgcGFzc2VkIHVzZXIgc3RvcHMgc2hhcmluZyBoaXMgc2NyZWVuIHRvIHVwZGF0ZSB0aGUgc3RhdGUuXG4gICAqIEBwYXJhbSB1c2VyIFxuICAgKi9cbiAgcHVibGljIHVzZXJTdG9wU2hhcmVTY3JlZW4odXNlcjogVXNlcik6IHZvaWQge1xuICAgIGNvbnN0IHVzZXJzID0gdGhpcy5nZXRVc2VycygpO1xuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gdGhpcy5maW5kVXNlcih1c2VycywgdXNlcik7XG4gICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICBjdXJyZW50VXNlci5zaGFyZVNjcmVlbiA9IGZhbHNlO1xuICAgICAgdGhpcy51c2VycyQubmV4dCh1c2Vycyk7XG4gICAgfVxuICAgIHRoaXMudXNlcnMkLm5leHQodXNlcnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpdmUgYWxsIHVzZXJzIHdobyBhcmUgY3VycmVudGx5IGluIHRoZSBzdGF0ZS5cbiAgICogQHJldHVybnMgQWxsIHVzZXJzIGN1cnJlbnRseSBpbiBzdGF0ZVxuICAgKi9cbiAgcHVibGljIGdldFVzZXJzKCk6IFVzZXJJbkNhbGxbXSB7XG4gICAgcmV0dXJuIHRoaXMudXNlcnMkLmdldFZhbHVlKCk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHVzZXIgVXNlciB3aXRoIGB1c2VySWRlbnRpZmllcmBcbiAgICogQHJldHVybnMgVXNlciBpbiBzdGF0ZVxuICAgKi9cbiAgcHVibGljIGdldFVzZXIodXNlcjogVXNlcik6IFVzZXJJbkNhbGwgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5nZXRVc2VycygpLmZpbmQoZSA9PiBlLnVzZXJbdGhpcy5pZGVudGlmaWVyXSA9PT0gdXNlclt0aGlzLmlkZW50aWZpZXJdKSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBgUGVlckNvbm5lY3Rpb25DbGllbnRgIHdpdGggdGhlIGdpdmVuIHNldHRpbmdzXG4gICAqIEBwYXJhbSBzZXR0aW5ncyBTZXR0aW5ncyBmb3IgY3JlYXRpbmcgdGhlIGBQZWVyQ29ubmVjdGlvbkNsaWVudGBcbiAgICogQHJldHVybnMgYFBlZXJDb25uZWN0aW9uQ2xpZW50YCBvYmplY3RcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjcmVhdGVQZWVyQ2xpZW50KHNldHRpbmdzOiBQZWVyQ29ubmVjdGlvbkNsaWVudFNldHRpbmdzKTogUHJvbWlzZTxQZWVyQ29ubmVjdGlvbkNsaWVudD4ge1xuICAgIHJldHVybiBuZXcgUGVlckNvbm5lY3Rpb25DbGllbnQoc2V0dGluZ3MpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdpdGggdGhpcyBtZXRob2RlIHlvdSBjYW4gY3JlYXRlIGEgUlRDQ2VydGlmaWNhdGUgdG8gc2VjdXJlIGEgY29ubmVjdGlvbi4gXG4gICAqIEBsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9SVENQZWVyQ29ubmVjdGlvbi9nZW5lcmF0ZUNlcnRpZmljYXRlXG4gICAqIEBwYXJhbSBhbGdvcml0aG0gQ2VydGlmaWNhdGUgb3B0aW9ucyB1c2VkIGJ5IGBSVENQZWVyQ29ubmVjdGlvbi5nZW5lcmF0ZUNlcnRpZmljYXRlKClgIERlZmF1bHQgYWxnb3JpdGhtIGBFQ0RTQWAgd2l0aCBjdXJ2ZSBgUC0yNTZgXG4gICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2ZSB0byBgUlRDQ2VydGlmaWNhdGVgXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgY3JlYXRlQ2VydGlmY2F0ZShhbGdvcml0aG06IHVua25vd24gPSB7XG4gICAgbmFtZTogJ0VDRFNBJyxcbiAgICBuYW1lZEN1cnZlOiAnUC0yNTYnXG4gIH0pOiBQcm9taXNlPFJUQ0NlcnRpZmljYXRlPiB7XG4gICAgcmV0dXJuIFJUQ1BlZXJDb25uZWN0aW9uLmdlbmVyYXRlQ2VydGlmaWNhdGUoYWxnb3JpdGhtIGFzIEFsZ29yaXRobUlkZW50aWZpZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIHNldCBjYWxsIHN0YXRlIHN0YXJ0ZWQgdG8gYHRydWVgLCB5b3UgY2FuIHN1YnNjcmliZSB0byBgQ2FsbFNlcnZpY2Uuc3RhcnRlZCRgIGZvciB1cGRhdGVzLlxuICAgKi9cbiAgcHVibGljIHN0YXJ0KCk6IHZvaWQge1xuICAgIHRoaXMuc3RhcnRlZCQubmV4dCh0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBzZXQgY2FsbCBzdGF0ZSBzdGFydGVkIHRvIGBmYWxzZWAsIHlvdSBjYW4gc3Vic2NyaWJlIHRvIGBDYWxsU2VydmljZS5zdGFydGVkJGAgZm9yIHVwZGF0ZXMuXG4gICAqL1xuICBwdWJsaWMgc3RvcCgpOiB2b2lkIHtcbiAgICB0aGlzLnN0YXJ0ZWQkLm5leHQoZmFsc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyZWQgdXNlciBpZGVudGlmaWVyLlxuICAgKiBAcmV0dXJucyBpZGVudGlmaWVyIHRvIHNlbGVjdCBhIFVzZXJcbiAgICovXG4gIHB1YmxpYyBnZXRVc2VySWRlbnRpZmllcigpOiAoa2V5b2YgVXNlcikge1xuICAgIHJldHVybiB0aGlzLmlkZW50aWZpZXI7XG4gIH1cblxuICBwcml2YXRlIGZpbmRVc2VyKHVzZXJzOiBVc2VySW5DYWxsW10sIHVzZXI6IFVzZXIpOiBVc2VySW5DYWxsIHwgbnVsbCB7XG4gICAgcmV0dXJuIHVzZXJzLmZpbmQoZSA9PiBlLnVzZXJbdGhpcy5pZGVudGlmaWVyXSA9PT0gdXNlclt0aGlzLmlkZW50aWZpZXJdKSB8fCBudWxsO1xuICB9XG5cbn1cbiJdfQ==